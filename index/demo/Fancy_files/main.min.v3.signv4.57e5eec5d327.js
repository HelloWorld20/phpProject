/*!
 * numeral.js
 * version : 1.5.3
 * author : Adam Draper
 * license : MIT
 * http://adamwdraper.github.com/Numeral-js/
 */
(function(){function a(a){this._value=a}function b(a,b,c,d){var e,f,g=Math.pow(10,b);return f=(c(a*g)/g).toFixed(b),d&&(e=new RegExp("0{1,"+d+"}$"),f=f.replace(e,"")),f}function c(a,b,c){var d;return d=b.indexOf("$")>-1?e(a,b,c):b.indexOf("%")>-1?f(a,b,c):b.indexOf(":")>-1?g(a,b):i(a._value,b,c)}function d(a,b){var c,d,e,f,g,i=b,j=["KB","MB","GB","TB","PB","EB","ZB","YB"],k=!1;if(b.indexOf(":")>-1)a._value=h(b);else if(b===q)a._value=0;else{for("."!==o[p].delimiters.decimal&&(b=b.replace(/\./g,"").replace(o[p].delimiters.decimal,".")),c=new RegExp("[^a-zA-Z]"+o[p].abbreviations.thousand+"(?:\\)|(\\"+o[p].currency.symbol+")?(?:\\))?)?$"),d=new RegExp("[^a-zA-Z]"+o[p].abbreviations.million+"(?:\\)|(\\"+o[p].currency.symbol+")?(?:\\))?)?$"),e=new RegExp("[^a-zA-Z]"+o[p].abbreviations.billion+"(?:\\)|(\\"+o[p].currency.symbol+")?(?:\\))?)?$"),f=new RegExp("[^a-zA-Z]"+o[p].abbreviations.trillion+"(?:\\)|(\\"+o[p].currency.symbol+")?(?:\\))?)?$"),g=0;g<=j.length&&!(k=b.indexOf(j[g])>-1?Math.pow(1024,g+1):!1);g++);a._value=(k?k:1)*(i.match(c)?Math.pow(10,3):1)*(i.match(d)?Math.pow(10,6):1)*(i.match(e)?Math.pow(10,9):1)*(i.match(f)?Math.pow(10,12):1)*(b.indexOf("%")>-1?.01:1)*((b.split("-").length+Math.min(b.split("(").length-1,b.split(")").length-1))%2?1:-1)*Number(b.replace(/[^0-9\.]+/g,"")),a._value=k?Math.ceil(a._value):a._value}return a._value}function e(a,b,c){var d,e,f=b.indexOf("$"),g=b.indexOf("("),h=b.indexOf("-"),j="";return b.indexOf(" $")>-1?(j=" ",b=b.replace(" $","")):b.indexOf("$ ")>-1?(j=" ",b=b.replace("$ ","")):b=b.replace("$",""),e=i(a._value,b,c),1>=f?e.indexOf("(")>-1||e.indexOf("-")>-1?(e=e.split(""),d=1,(g>f||h>f)&&(d=0),e.splice(d,0,o[p].currency.symbol+j),e=e.join("")):e=o[p].currency.symbol+j+e:e.indexOf(")")>-1?(e=e.split(""),e.splice(-1,0,j+o[p].currency.symbol),e=e.join("")):e=e+j+o[p].currency.symbol,e}function f(a,b,c){var d,e="",f=100*a._value;return b.indexOf(" %")>-1?(e=" ",b=b.replace(" %","")):b=b.replace("%",""),d=i(f,b,c),d.indexOf(")")>-1?(d=d.split(""),d.splice(-1,0,e+"%"),d=d.join("")):d=d+e+"%",d}function g(a){var b=Math.floor(a._value/60/60),c=Math.floor((a._value-60*b*60)/60),d=Math.round(a._value-60*b*60-60*c);return b+":"+(10>c?"0"+c:c)+":"+(10>d?"0"+d:d)}function h(a){var b=a.split(":"),c=0;return 3===b.length?(c+=60*Number(b[0])*60,c+=60*Number(b[1]),c+=Number(b[2])):2===b.length&&(c+=60*Number(b[0]),c+=Number(b[1])),Number(c)}function i(a,c,d){var e,f,g,h,i,j,k=!1,l=!1,m=!1,n="",r=!1,s=!1,t=!1,u=!1,v=!1,w="",x="",y=Math.abs(a),z=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],A="",B=!1;if(0===a&&null!==q)return q;if(c.indexOf("(")>-1?(k=!0,c=c.slice(1,-1)):c.indexOf("+")>-1&&(l=!0,c=c.replace(/\+/g,"")),c.indexOf("a")>-1&&(r=c.indexOf("aK")>=0,s=c.indexOf("aM")>=0,t=c.indexOf("aB")>=0,u=c.indexOf("aT")>=0,v=r||s||t||u,c.indexOf(" a")>-1?(n=" ",c=c.replace(" a","")):c=c.replace("a",""),y>=Math.pow(10,12)&&!v||u?(n+=o[p].abbreviations.trillion,a/=Math.pow(10,12)):y<Math.pow(10,12)&&y>=Math.pow(10,9)&&!v||t?(n+=o[p].abbreviations.billion,a/=Math.pow(10,9)):y<Math.pow(10,9)&&y>=Math.pow(10,6)&&!v||s?(n+=o[p].abbreviations.million,a/=Math.pow(10,6)):(y<Math.pow(10,6)&&y>=Math.pow(10,3)&&!v||r)&&(n+=o[p].abbreviations.thousand,a/=Math.pow(10,3))),c.indexOf("b")>-1)for(c.indexOf(" b")>-1?(w=" ",c=c.replace(" b","")):c=c.replace("b",""),g=0;g<=z.length;g++)if(e=Math.pow(1024,g),f=Math.pow(1024,g+1),a>=e&&f>a){w+=z[g],e>0&&(a/=e);break}return c.indexOf("o")>-1&&(c.indexOf(" o")>-1?(x=" ",c=c.replace(" o","")):c=c.replace("o",""),x+=o[p].ordinal(a)),c.indexOf("[.]")>-1&&(m=!0,c=c.replace("[.]",".")),h=a.toString().split(".")[0],i=c.split(".")[1],j=c.indexOf(","),i?(i.indexOf("[")>-1?(i=i.replace("]",""),i=i.split("["),A=b(a,i[0].length+i[1].length,d,i[1].length)):A=b(a,i.length,d),h=A.split(".")[0],A=A.split(".")[1].length?o[p].delimiters.decimal+A.split(".")[1]:"",m&&0===Number(A.slice(1))&&(A="")):h=b(a,null,d),h.indexOf("-")>-1&&(h=h.slice(1),B=!0),j>-1&&(h=h.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+o[p].delimiters.thousands)),0===c.indexOf(".")&&(h=""),(k&&B?"(":"")+(!k&&B?"-":"")+(!B&&l?"+":"")+h+A+(x?x:"")+(n?n:"")+(w?w:"")+(k&&B?")":"")}function j(a,b){o[a]=b}function k(a){var b=a.toString().split(".");return b.length<2?1:Math.pow(10,b[1].length)}function l(){var a=Array.prototype.slice.call(arguments);return a.reduce(function(a,b){var c=k(a),d=k(b);return c>d?c:d},-1/0)}var m,n="1.5.3",o={},p="en",q=null,r="0,0",s="undefined"!=typeof module&&module.exports;m=function(b){return m.isNumeral(b)?b=b.value():0===b||"undefined"==typeof b?b=0:Number(b)||(b=m.fn.unformat(b)),new a(Number(b))},m.version=n,m.isNumeral=function(b){return b instanceof a},m.language=function(a,b){if(!a)return p;if(a&&!b){if(!o[a])throw new Error("Unknown language : "+a);p=a}return(b||!o[a])&&j(a,b),m},m.languageData=function(a){if(!a)return o[p];if(!o[a])throw new Error("Unknown language : "+a);return o[a]},m.language("en",{delimiters:{thousands:",",decimal:"."},abbreviations:{thousand:"k",million:"m",billion:"b",trillion:"t"},ordinal:function(a){var b=a%10;return 1===~~(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th"},currency:{symbol:"$"}}),m.zeroFormat=function(a){q="string"==typeof a?a:null},m.defaultFormat=function(a){r="string"==typeof a?a:"0.0"},"function"!=typeof Array.prototype.reduce&&(Array.prototype.reduce=function(a,b){"use strict";if(null===this||"undefined"==typeof this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof a)throw new TypeError(a+" is not a function");var c,d,e=this.length>>>0,f=!1;for(1<arguments.length&&(d=b,f=!0),c=0;e>c;++c)this.hasOwnProperty(c)&&(f?d=a(d,this[c],c,this):(d=this[c],f=!0));if(!f)throw new TypeError("Reduce of empty array with no initial value");return d}),m.fn=a.prototype={clone:function(){return m(this)},format:function(a,b){return c(this,a?a:r,void 0!==b?b:Math.round)},unformat:function(a){return"[object Number]"===Object.prototype.toString.call(a)?a:d(this,a?a:r)},value:function(){return this._value},valueOf:function(){return this._value},set:function(a){return this._value=Number(a),this},add:function(a){function b(a,b){return a+c*b}var c=l.call(null,this._value,a);return this._value=[this._value,a].reduce(b,0)/c,this},subtract:function(a){function b(a,b){return a-c*b}var c=l.call(null,this._value,a);return this._value=[a].reduce(b,this._value*c)/c,this},multiply:function(a){function b(a,b){var c=l(a,b);return a*c*b*c/(c*c)}return this._value=[this._value,a].reduce(b,1),this},divide:function(a){function b(a,b){var c=l(a,b);return a*c/(b*c)}return this._value=[this._value,a].reduce(b),this},difference:function(a){return Math.abs(m(this._value).subtract(a).value())}},s&&(module.exports=m),"undefined"==typeof ender&&(this.numeral=m),"function"==typeof define&&define.amd&&define([],function(){return m})}).call(this);String.prototype.escape_html=function(){var map={"&":"amp","<":"lt",">":"gt",'"':"quot"};return this.replace(/&|<|>|\"/g,function(c){return map[c]?"&"+map[c]+";":c})};if(typeof String.prototype.trim=="undefined"){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}String.prototype.startsWith=function(str){return this.indexOf(str)===0};String.prototype.is_int=function(){return parseFloat(this)==parseInt(this)&&!isNaN(this)};Number.prototype.toCurrency=function(n){if(parseFloat(this)==parseInt(this)){return this.toString()}return this.toFixed(n)};function namespace(name){var names=name.split("."),theLast=window,i=-1;while(names[++i]){if(!(names[i]in theLast))theLast[names[i]]={};theLast=theLast[names[i]]}return theLast}function parseURL(url){var fn=arguments.callee;if(!fn.anchor)fn.anchor=document.createElement("a");fn.anchor.setAttribute("href",url);return{protocol:fn.anchor.protocol,host:fn.anchor.host,hostname:fn.anchor.hostname,port:fn.anchor.port,pathname:fn.anchor.pathname.replace(/^\/?/,"/"),hash:fn.anchor.hash,search:fn.anchor.search}}function date_created_since(date_str){try{var dstr=date_str.replace(" ","T");var nDate=new Date(dstr);var now=new Date;var seconds=Math.round((now-nDate)/1e3);var mins=Math.floor(seconds/60);var hours=Math.floor(mins/60);var days=Math.floor(hours/24);if(days>7)return days+" days";if(days==7)return"a week";if(days==1)return"a day";if(days>1)return days+" days";if(hours==1)return"an hour";if(hours>1)return hours+" hours";if(mins==1)return"a min";if(mins>1)return mins+" min";if(seconds==1)return"a sec";if(seconds>1)return seconds+" sec";return"Now"}catch(err){return""}}jQuery.cookie={get:function(name){var regex=new RegExp("(^|[ ;])"+name+"\\s*=\\s*([^\\s;]+)");return regex.test(document.cookie)?unescape(RegExp.$2):null},set:function(name,value,days){var expire=new Date;expire.setDate(expire.getDate()+(days||0));cookie_str=name+"="+escape(value)+(days?";expires="+expire:"");if(name=="lang")cookie_str+="; path=/";document.cookie=cookie_str}};/* Modernizr 2.6.2 (Custom Build) | MIT & BSD
 * Build: http://modernizr.com/download/#-csstransitions-testprop-testallprops-domprefixes
 * license
 */
window.Modernizr=function(a,b,c){function w(a){i.cssText=a}function x(a,b){return w(prefixes.join(a+";")+(b||""))}function y(a,b){return typeof a===b}function z(a,b){return!!~(""+a).indexOf(b)}function A(a,b){for(var d in a){var e=a[d];if(!z(e,"-")&&i[e]!==c)return b=="pfx"?e:!0}return!1}function B(a,b,d){for(var e in a){var f=b[a[e]];if(f!==c)return d===!1?a[e]:y(f,"function")?f.bind(d||b):f}return!1}function C(a,b,c){var d=a.charAt(0).toUpperCase()+a.slice(1),e=(a+" "+m.join(d+" ")+d).split(" ");return y(b,"string")||y(b,"undefined")?A(e,b):(e=(a+" "+n.join(d+" ")+d).split(" "),B(e,b,c))}var d="2.6.2",e={},f=b.documentElement,g="modernizr",h=b.createElement(g),i=h.style,j,k={}.toString,l="Webkit Moz O ms",m=l.split(" "),n=l.toLowerCase().split(" "),o={},p={},q={},r=[],s=r.slice,t,u={}.hasOwnProperty,v;!y(u,"undefined")&&!y(u.call,"undefined")?v=function(a,b){return u.call(a,b)}:v=function(a,b){return b in a&&y(a.constructor.prototype[b],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(b){var c=this;if(typeof c!="function")throw new TypeError;var d=s.call(arguments,1),e=function(){if(this instanceof e){var a=function(){};a.prototype=c.prototype;var f=new a,g=c.apply(f,d.concat(s.call(arguments)));return Object(g)===g?g:f}return c.apply(b,d.concat(s.call(arguments)))};return e}),o.csstransitions=function(){return C("transition")};for(var D in o)v(o,D)&&(t=D.toLowerCase(),e[t]=o[D](),r.push((e[t]?"":"no-")+t));return e.addTest=function(a,b){if(typeof a=="object")for(var d in a)v(a,d)&&e.addTest(d,a[d]);else{a=a.toLowerCase();if(e[a]!==c)return e;b=typeof b=="function"?b():b,typeof enableClasses!="undefined"&&enableClasses&&(f.className+=" "+(b?"":"no-")+a),e[a]=b}return e},w(""),h=j=null,e._version=d,e._domPrefixes=n,e._cssomPrefixes=m,e.testProp=function(a){return A([a])},e.testAllProps=C,e}(this,this.document);try{(function(g){function m(){if(e.jStorage)try{d=n(""+e.jStorage)}catch(a){e.jStorage="{}"}else e.jStorage="{}";j=e.jStorage?(""+e.jStorage).length:0}function h(){try{e.jStorage=o(d),c&&(c.setAttribute("jStorage",e.jStorage),c.save("jStorage")),j=e.jStorage?(""+e.jStorage).length:0}catch(a){}}function i(a){if(!a||"string"!=typeof a&&"number"!=typeof a)throw new TypeError("Key name must be string or numeric");if("__jstorage_meta"==a)throw new TypeError("Reserved key name");return!0}function k(){var a,b,c,e=Infinity,f=!1;clearTimeout(p);if(d.__jstorage_meta&&"object"==typeof d.__jstorage_meta.TTL){a=+new Date;c=d.__jstorage_meta.TTL;for(b in c)c.hasOwnProperty(b)&&(c[b]<=a?(delete c[b],delete d[b],f=!0):c[b]<e&&(e=c[b]));Infinity!=e&&(p=setTimeout(k,e-a));f&&h()}}if(!g||!g.toJSON&&!Object.toJSON&&!window.JSON)throw Error("jQuery, MooTools or Prototype needs to be loaded before jStorage!");var d={},e={jStorage:"{}"},c=null,j=0,o=g.toJSON||Object.toJSON||window.JSON&&(JSON.encode||JSON.stringify),n=g.evalJSON||window.JSON&&(JSON.decode||JSON.parse)||function(a){return(""+a).evalJSON()},f=!1,p,l={isXML:function(a){return(a=(a?a.ownerDocument||a:0).documentElement)?"HTML"!==a.nodeName:!1},encode:function(a){if(!this.isXML(a))return!1;try{return(new XMLSerializer).serializeToString(a)}catch(b){try{return a.xml}catch(d){}}return!1},decode:function(a){var b="DOMParser"in window&&(new DOMParser).parseFromString||window.ActiveXObject&&function(a){var b=new ActiveXObject("Microsoft.XMLDOM");b.async="false";b.loadXML(a);return b};if(!b)return!1;a=b.call("DOMParser"in window&&new DOMParser||window,a,"text/xml");return this.isXML(a)?a:!1}};g.jStorage={version:"0.1.7.0",set:function(a,b,c){i(a);c=c||{};l.isXML(b)?b={_is_xml:!0,xml:l.encode(b)}:"function"==typeof b?b=null:b&&"object"==typeof b&&(b=n(o(b)));d[a]=b;isNaN(c.TTL)?h():this.setTTL(a,c.TTL);return b},get:function(a,b){i(a);return a in d?d[a]&&"object"==typeof d[a]&&d[a]._is_xml&&d[a]._is_xml?l.decode(d[a].xml):d[a]:"undefined"==typeof b?null:b},deleteKey:function(a){i(a);return a in d?(delete d[a],d.__jstorage_meta&&("object"==typeof d.__jstorage_meta.TTL&&a in d.__jstorage_meta.TTL)&&delete d.__jstorage_meta.TTL[a],h(),!0):!1},setTTL:function(a,b){var c=+new Date;i(a);b=Number(b)||0;return a in d?(d.__jstorage_meta||(d.__jstorage_meta={}),d.__jstorage_meta.TTL||(d.__jstorage_meta.TTL={}),0<b?d.__jstorage_meta.TTL[a]=c+b:delete d.__jstorage_meta.TTL[a],h(),k(),!0):!1},flush:function(){d={};h();return!0},storageObj:function(){function a(){}a.prototype=d;return new a},index:function(){var a=[],b;for(b in d)d.hasOwnProperty(b)&&"__jstorage_meta"!=b&&a.push(b);return a},storageSize:function(){return j},currentBackend:function(){return f},storageAvailable:function(){return!!f},reInit:function(){var a;if(c&&c.addBehavior){a=document.createElement("link");c.parentNode.replaceChild(a,c);c=a;c.style.behavior="url(#default#userData)";document.getElementsByTagName("head")[0].appendChild(c);c.load("jStorage");a="{}";try{a=c.getAttribute("jStorage")}catch(b){}e.jStorage=a;f="userDataBehavior"}m()}};(function(){var a=!1;if("localStorage"in window)try{window.localStorage.setItem("_tmptest","tmpval"),a=!0,window.localStorage.removeItem("_tmptest")}catch(b){}if(a)try{window.localStorage&&(e=window.localStorage,f="localStorage")}catch(d){}else if("globalStorage"in window)try{window.globalStorage&&(e=window.globalStorage[window.location.hostname],f="globalStorage")}catch(g){}else if(c=document.createElement("link"),c.addBehavior){c.style.behavior="url(#default#userData)";document.getElementsByTagName("head")[0].appendChild(c);c.load("jStorage");a="{}";try{a=c.getAttribute("jStorage")}catch(h){}e.jStorage=a;f="userDataBehavior"}else{c=null;return}m();k()})()})(window.$||window.jQuery)}catch(e){jQuery.jStorage={get:function(){},set:function(){},deleteKey:function(){},flush:function(){},index:function(){}}}/* tipsy, facebook style tooltips for jquery, version 1.0.0a
 * (c) 2008-2010 jason frame [jason@onehackoranother.com]
 * released under the MIT license
 */
(function(e){function t(e,t){return typeof e=="function"?e.call(t):e}function n(e){while(e=e.parentNode)if(e==document)return!0;return!1}function r(t,n){this.$element=e(t),this.options=n,this.enabled=!0,this.fixTitle()}r.prototype={show:function(){var n=this.getTitle();if(n&&this.enabled){var r=this.tip();r.find(".tipsy-inner")[this.options.html?"html":"text"](n),r[0].className="tipsy",r.remove().css({top:0,left:0,visibility:"hidden",display:"block"}).prependTo(document.body);var i=e.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight}),s=r[0].offsetWidth,o=r[0].offsetHeight,u=t(this.options.gravity,this.$element[0]),a;switch(u.charAt(0)){case"n":a={top:i.top+i.height+this.options.offset,left:i.left+i.width/2-s/2};break;case"s":a={top:i.top-o-this.options.offset,left:i.left+i.width/2-s/2};break;case"e":a={top:i.top+i.height/2-o/2,left:i.left-s-this.options.offset};break;case"w":a={top:i.top+i.height/2-o/2,left:i.left+i.width+this.options.offset}}u.length==2&&(u.charAt(1)=="w"?a.left=i.left+i.width/2-15:a.left=i.left+i.width/2-s+15),r.css(a).addClass("tipsy-"+u),r.find(".tipsy-arrow")[0].className="tipsy-arrow tipsy-arrow-"+u.charAt(0),this.options.className&&r.addClass(t(this.options.className,this.$element[0])),this.options.fade?r.stop().css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:this.options.opacity}):r.css({visibility:"visible",opacity:this.options.opacity})}},hide:function(){this.options.fade?this.tip().stop().fadeOut(function(){e(this).remove()}):this.tip().remove()},fixTitle:function(){var e=this.$element;(e.attr("title")||typeof e.attr("original-title")!="string")&&e.attr("original-title",e.attr("title")||"").removeAttr("title")},getTitle:function(){var e,t=this.$element,n=this.options;this.fixTitle();var e,n=this.options;return typeof n.title=="string"?e=t.attr(n.title=="title"?"original-title":n.title):typeof n.title=="function"&&(e=n.title.call(t[0])),e=(""+e).replace(/(^\s*|\s*$)/,""),e||n.fallback},tip:function(){return this.$tip||(this.$tip=e('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"></div>'),this.$tip.data("tipsy-pointee",this.$element[0])),this.$tip},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled}},e.fn.tipsy=function(t){function i(n){var i=e.data(n,"tipsy");return i||(i=new r(n,e.fn.tipsy.elementOptions(n,t)),e.data(n,"tipsy",i)),i}function s(){var e=i(this);e.hoverState="in",t.delayIn==0?e.show():(e.fixTitle(),setTimeout(function(){e.hoverState=="in"&&e.show()},t.delayIn))}function o(){var e=i(this);e.hoverState="out",t.delayOut==0?e.hide():setTimeout(function(){e.hoverState=="out"&&e.hide()},t.delayOut)}if(t===!0)return this.data("tipsy");if(typeof t=="string"){var n=this.data("tipsy");return n&&n[t](),this}t=e.extend({},e.fn.tipsy.defaults,t),t.live||this.each(function(){i(this)});if(t.trigger!="manual"){var u=t.live?"live":"bind",a=t.trigger=="hover"?"mouseenter":"focus",f=t.trigger=="hover"?"mouseleave":"blur";this[u](a,s)[u](f,o)}return this},e.fn.tipsy.defaults={className:null,delayIn:0,delayOut:0,fade:!1,fallback:"",gravity:"n",html:!1,live:!1,offset:0,opacity:.8,title:"title",trigger:"hover"},e.fn.tipsy.revalidate=function(){e(".tipsy").each(function(){var t=e.data(this,"tipsy-pointee");(!t||!n(t))&&e(this).remove()})},e.fn.tipsy.elementOptions=function(t,n){return e.metadata?e.extend({},n,e(t).metadata()):n},e.fn.tipsy.autoNS=function(){return e(this).offset().top>e(document).scrollTop()+e(window).height()/2?"s":"n"},e.fn.tipsy.autoWE=function(){return e(this).offset().left>e(document).scrollLeft()+e(window).width()/2?"e":"w"},e.fn.tipsy.autoBounds=function(t,n){return function(){var r={ns:n[0],ew:n.length>1?n[1]:!1},i=e(document).scrollTop()+t,s=e(document).scrollLeft()+t,o=e(this);return o.offset().top<i&&(r.ns="n"),o.offset().left<s&&(r.ew="w"),e(window).width()+e(document).scrollLeft()-o.offset().left<t&&(r.ew="e"),e(window).height()+e(document).scrollTop()-o.offset().top<t&&(r.ns="s"),r.ns+(r.ew?r.ew:"")}}})(jQuery);(function($){$.fn.disable=function(b){if(b==undefined)b=true;this.prop("disabled",b);b?this.addClass("disabled"):this.removeClass("disabled");return this}})(jQuery);jQuery.parseString=function(str){var args={};str=str.split(/&/g);for(var i=0;i<str.length;i++){if(/^([^=]+)(?:=(.*))?$/.test(str[i]))args[RegExp.$1]=decodeURIComponent(RegExp.$2)}return args};location.args=jQuery.parseString(location.search.substr(1));window.require_login=function(next){if($(".popup.sign.signup")[0]){$("#fancy-g-signin").attr("next",next);$social=$(".social");if($social.length>0){$social.attr("next",next)}$(".popup.sign.signup").find("input.next_url").val(next).end().find("a.signup").attr("href","/register?next="+next).end().find("a.signin").attr("href","/login?next="+next);$.dialog("popup.sign.signup").open()}else{var path=location.pathname.toString();if(typeof next!="string"||/^#/.test(next))next="";if(!next&&path!="/"&&!/^\/login/.test(path))next=location.pathname+location.search;location.href="/signup"+(next?"?next="+encodeURIComponent(next):"")}return false};window.addCommas=function(nStr){nStr+="";x=nStr.split(".");x1=x[0];x2=x.length>1?"."+x[1]:"";var rgx=/(\d+)(\d{3})/;while(rgx.test(x1)){x1=x1.replace(rgx,"$1"+","+"$2")}return x1+x2};window.to_price_string=function(nStr){if(parseInt(nStr)==parseFloat(nStr)){nStr=parseInt(nStr).toString()}return addCommas(nStr)};window.scrollToElement=function(elem,top){var pos=elem.offset().top;if(top!=undefined)pos-=top;$("html, body").animate({scrollTop:pos+"px"},"fast")};if(document.createElement("input").placeholder==undefined){$("input[placeholder], textarea[placeholder]").each(function(){var fld=this,$fld=$(this),text=this.getAttribute("placeholder");function setPlaceholder(){var v=$.trim(fld.value);if(v==text||v==""){$fld.val(text).addClass("placeholder")}else{$fld.val(v).removeClass("placeholder")}}function removePlaceholder(){var v=$.trim(fld.value);if(v==text||v=="")$fld.val("").removeClass("placeholder")}setPlaceholder();$fld.focus(removePlaceholder).blur(setPlaceholder).closest("form").submit(removePlaceholder);$fld.parents(".popup").find("button").click(removePlaceholder);$fld.parents("#content").find("button").click(removePlaceholder)})}(function($){var keys={13:"ENTER",27:"ESC",38:"UP",40:"DOWN"};var defaults={itemSelector:"li",selectedClass:"selected",onShowList:$.noop,onHideList:$.noop,onSelect:$.noop,onChange:$.noop,onRequestDone:$.noop};$.fn.usercomplete=function(options){options=$.extend({},defaults,options);var $this=this,$list=$(options.listSelector),$tpl=$list.find('script[type="fancy/template"]'),$par=$tpl.parent(),timer,prev_v="";this.data({"usercomplete-list":$list,"usercomplete-tpl":$tpl,"usercomplete-options":options});this.on("keydown.usercomplete",function(event){var k=keys[event.which];if(!k||!$list.length||$list.is(":hidden"))return;event.preventDefault();if(k=="ESC")return $list.hide();var $children=$par.children(options.itemSelector),$selected=$children.filter("."+options.selectedClass),$another;if(k=="ENTER"){if($selected.length)options.onSelect($selected);hideList();return}if(!$selected.length){$selected=$children.eq(0).addClass(options.selectedClass);options.onChange($selected)}else if(k=="UP"){$another=$selected.prev(options.itemSelector)}else if(k=="DOWN"){$another=$selected.next(options.itemSelector)}if(!$another||!$another.length)return;$selected.removeClass(options.selectedClass);$another.addClass(options.selectedClass);options.onChange($another)}).on("keyup.usercomplete",function(event){var v=$.trim(this.value);if(v==prev_v)return;prev_v=v;if(v.length==0)return hideList();showList();clearTimeout(timer);timer=setTimeout(request,500)});$list.on({mouseover:function(){$par.children().removeClass(options.selectedClass);options.onChange($(this).addClass(options.selectedClass))},click:function(event){event.preventDefault();options.onSelect($(this));hideList()}},options.itemSelector);function hideList(){options.onHideList();$list.hide()}function showList(){options.onShowList();$list.show()}function request(){var v=$.trim($this.val());$.ajax({type:"GET",url:"/search-users.json",data:{term:v},dataType:"json",success:function(json){if($list.length&&$tpl.length){$par.empty();for(var i=0,c=json.length;i<c;i++){$tpl.template(json[i]).data("usercomplete-data",json[i]).appendTo($par)}}options.onRequestDone(json)}})}return this}})(jQuery);window.Fancy={init:function(){Fancy.scrollToTop();Fancy.buttons();Fancy.formTips();Fancy.verifiedTips();Fancy.privateTips();Fancy.popupTips();Fancy.usersAutoComplete();Fancy.validation();Fancy.notification();Fancy.usernameSyn();Fancy.changePass();Fancy.filter();Fancy.fieldFocus();Fancy.datePicker();Fancy.customize();Fancy.selectAllFriends();$(".live-chat .chat-set .text-rnd").each(function(){var orginTxt=$(this).attr("placeholder");if($(this).val()=="")$(this).addClass("placeholder").val(orginTxt).removeAttr("placeholder");$(this).focus(function(){if($(this).val()==orginTxt)$(this).val("").removeClass("placeholder")});$(this).blur(function(){if($(this).val()=="")$(this).val(orginTxt).addClass("placeholder")})})},scrollToTop:function(){var scrollBtn=$("#scroll-to-top");scrollBtn.hide();$(function(){var lastCheckTime=+new Date;$(window).scroll(function(){if(lastCheckTime+1e3>+new Date)return;lastCheckTime=+new Date;if($(this).scrollTop()>300){scrollBtn.fadeIn();$("#header-new .live-chat").css("right",$("#scroll-to-top").width()+52+"px")}else{scrollBtn.fadeOut();$("#header-new .live-chat").css("right","11px")}});scrollBtn.click(function(){$("body,html").animate({scrollTop:0},800);return false})})},buttons:function(){$("#content,#sidebar,#summary,#popup_container,#show_usercard").on({click:function(event){var $this=$(this),login_require=$this.attr("require_login"),url,following,params,tnode=getTextNode(this);event.preventDefault();if(typeof login_require!=undefined&&login_require==="true")return require_login();if($this.hasClass("loading")||$this.hasClass("list_"))return;$this.addClass("loading");if(following=$this.hasClass("following")){url="/delete_follow.xml"}else{url="/add_follow.xml"}params={};var btnStr=gettext("Follow");var btnFollowingStr=gettext("Following");if($this.attr("uid")){params["user_id"]=$this.attr("uid")}if($this.attr("eid")){params["directory_entry_id"]=$this.attr("eid")}if($this.attr("sid")){params["seller_id"]=$this.attr("sid");btnStr=gettext("Follow Store");btnFollowingStr=gettext("Following Store")}if($this.attr("lid")&&$this.attr("loid")){params.lid=$this.attr("lid");params.loid=$this.attr("loid");url=following?"/unfollow_list.xml":"/follow_list.xml";btnStr=gettext("Follow List");btnFollowingStr=gettext("Following List")}if(!params.user_id&&!params.directory_entry_id&&!params.seller_id&&!params.lid){$this.removeClass("loading");return}var old_text,old_uid,old_style;old_text=tnode.nodeValue;if(following){if($this.hasClass("btn-private")==false){tnode.nodeValue=$this.attr("linktype")=="private"?"":btnStr;old_style=$this.attr("style");$this.removeClass("following").removeAttr("style")}else{tnode.nodeValue=gettext("Private");old_uid=$this.attr("uid");$this.removeClass("following").removeAttr("uid")}}else{tnode.nodeValue=btnFollowingStr;$this.addClass("following")}var revert_button=function(){if(following){if($this.hasClass("btn-private")==false){tnode.nodeValue=old_text;$this.addClass("following").attr("style",old_style)}else{tnode.nodeValue=old_text;$this.addClass("following").attr("uid",old_uid)}}else{tnode.nodeValue=old_text;$this.removeClass("following")}};$.ajax({type:"post",url:url,data:params,dataType:"xml",success:function(xml){var $xml=$(xml),$st=$xml.find("status_code");if($st.length&&$st.text()){if(!following){if($this.attr("linktype")=="recommended"){var shown_ids="";$this.closest("ul,ol").find(".follow-link").each(function(){shown_ids+=this.getAttribute("uid")+","});$.get("/_single_vcard.html?uids="+shown_ids,function(html){var $li=$this.parent("li");$li.delay(1e3).fadeTo(500,.01,function(){$li.html(html)}).fadeTo(250,1)})}}}else{var $msg=$xml.find("message");if($msg.length)alert($msg.text());revert_button()}},error:function(){alert(gettext("Please retry your request."));revert_button()},complete:function(){$this.removeClass("loading")}});return false},mouseover:function(){var $this=$(this),tnode=getTextNode(this);var btnStr=gettext("Unfollow");if($this.hasClass("following")&&tnode){if($this.attr("sid"))btnStr=gettext("Unfollow Store");if($this.attr("lid"))btnStr=gettext("Unfollow List");$this.addClass("dimmed");tnode.nodeValue=btnStr}},mouseout:function(){var $this=$(this),tnode=getTextNode(this);var btnStr=gettext("Following");if($this.hasClass("following")&&tnode){$this.removeClass("dimmed");if($this.attr("sid"))btnStr=gettext("Following Store");if($this.attr("lid"))btnStr=gettext("Following List");if($this.hasClass("btn-private")){tnode.nodeValue=gettext("Private")}else{tnode.nodeValue=btnStr}}}},".follow-user-link, .follow-link, .button.follow, a.follow.entry, a.follow");function getTextNode(el){while(el=el.lastChild){if(el.nodeType==3&&el.nodeValue)return el}return null}},formTips:function(){if($(".page-deal-create").length){$(".page-deal-create #content input[title]").tipsy({trigger:"focus",gravity:"n",html:true})}},verifiedTips:function(){$(".nickname span.ico-link[title]").tipsy({trigger:"hover",gravity:"s",html:true})},privateTips:function(){$(".vcard span.ico-private[title]").tipsy({trigger:"hover",gravity:"s",html:true})},popupTips:function(){$("#new-category[title]").tipsy({trigger:"focus",gravity:"s",html:true})},usersAutoComplete:function(){if(!$("#users").length){return}$.widget("ui.customautocomplete",$.extend({},$.ui.autocomplete.prototype,{_response:function(contents){$.ui.autocomplete.prototype._response.apply(this,arguments);$(this.element).trigger("autocompletesearchcomplete",[contents])}}));$("#users").customautocomplete({minLength:0,source:"/search-users.json",focus:function(event,ui){$("#users").val(ui.item.username);return false},select:function(event,ui){$("#users").val(ui.item.username).attr("uid",ui.item.id);return false}}).data("autocomplete")._renderItem=function(ul,item){return $("<li></li>").data("item.autocomplete",item).append('<a><img style="max-width:30px;max-height:30px;" src="'+item.image_url+'" />'+item.username+"<span>"+item.name+"</span>"+"</a>").appendTo(ul)};$("#users").bind("autocompletesearchcomplete",function(event,contents){var users=$("#users");if(contents.length===0){users.removeClass("found")}else{users.addClass("found")}$("#showpopup form").validate().element("#users")})},validation:function(){var $form=$(".sign #content form");if(!$form.length||!$form.validate)return;$form.validate({rules:{password:"required",username:"required",name:"required"},messages:{email:"Hmm, that doesn't look like a valid email address."}})},notification:function(){$(".hide-notification").click(function(){$(".notification").slideToggle("slow")})},usernameSyn:function(){var obj=$("input#username");if(obj.length){obj.keyup(function(){obj.next(".username").children("strong").html($("input#username").val().replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;"))})}},changePass:function(){$("#change-password").find(".pass-trigger").click(function(){$(this).hide();$(this).next("ul").animate({height:100},400);$(this).parent("#change-password").addClass("snp-expanded");return false})},filter:function(){var filter=$("#filter");var em=filter.find("h3 em");filter.click(function(){$(this).toggleClass("expanded")});filter.find("a").click(function(e){em.html($(this).text());e.preventDefault()})},fieldFocus:function(){var sfEls=document.getElementsByTagName("INPUT");for(var i=0;i<sfEls.length;i++){if(sfEls[i].type!="text")continue;sfEls[i].onfocus=function(){$(this).addClass("sffocus").parent().addClass("hastext")};sfEls[i].onblur=function(){this.className=this.className.replace(new RegExp(" sffocus\\b"),"")}}},datePicker:function(){if($.fn.datepicker)$("#deal-end, #deal-start, #store_deal_expiration, #date_from, #date_to, #start_date, #end_date").datepicker()},customize:function(){$("#content div.customize .toggle").click(function(){$(this).parents(".customize").addClass("opened");return false});$("#content div.customize .send").click(function(){var show_featured_items=$("#content div.customize #show_featured_items").is(":checked");var show_followed_adds=$("#content div.customize #show_followed_adds").is(":checked");var show_shown_to_you=$("#content div.customize #show_shown_to_you").is(":checked");var show_followed_fancyd=$("#content div.customize #show_followed_fancyd").is(":checked");var selectedRow=$(this);var param={};param["show_featured_items"]=show_featured_items;param["show_followed_adds"]=show_followed_adds;param["show_shown_to_you"]=show_shown_to_you;param["show_followed_fancyd"]=show_followed_fancyd;$.post("/update_timeline.xml",param,function(xml){if($(xml).find("status_code").length>0&&$(xml).find("status_code").text()==1){selectedRow.parents(".customize").removeClass("opened");location.reload(false)}else if($(xml).find("status_code").length>0&&$(xml).find("status_code").text()==0){alert($(xml).find("message").text())}},"xml");return false})},selectAllFriends:function(){if(!$("#content .friends-list").length){return}var all=$("#all");var checkboxes=$("#content .friends-list ul input[type=checkbox]");var all_link=$("#content .friends-list .selected a");function toggleAll(){if(all.is(":checked")){checkboxes.attr("checked","checked")}else{checkboxes.removeAttr("checked","")}}all_link.bind("click",function(){all.attr("checked",!all.is(":checked"));toggleAll();return false});all.bind("click",function(){toggleAll()});checkboxes.bind("click",function(){var checked=$("#content .friends-list ul input[type=checkbox]:checked");if(checked.length===checkboxes.length){all.attr("checked","checked")}else{all.removeAttr("checked","")}})}};jQuery.fn.template=function(args){if(!args)args={};var html=jQuery.trim(this.html()).replace(/##(\w+)##/g,function(whole,name){return args[name]||""});return jQuery(html)};(function($){var $body;$.fn.hotkey=function(hotkey,handler){if($.isPlainObject(hotkey)){var _this=this;$.each(hotkey,function(_hotkey,_handler){_this.hotkey(_hotkey,_handler)});return}hotkey=parse(hotkey);if(!hotkey)return this;var $el=this;if($el.get(0)===window||$el.get(0)===document)$el=$body;var handlers=$el.data("hotkey-handlers"),strHotkey=serialize(hotkey);if(!handlers){$el.data("hotkey-handlers",handlers={});$el.on("keydown",keyHandler)}handlers[strHotkey]=handler;return this};$.hotkey=function(){if(!$body)$body=$("body");$body.hotkey.apply($body,arguments)};$.hotkey.specialKeys={BACKSPACE:8,TAB:9,ENTER:13,RETURN:13,PAUSE:19,CAPSLOCK:20,ESC:27,SPACE:32,PAGEUP:33,PGUP:33,PAGEDOWN:34,PGDN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,INS:45,DELETE:46,DEL:46,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"'":222};function parse(strHotkey){var ret={altKey:false,ctrlKey:false,shiftKey:false,metaKey:false,keyCode:null},keys=strHotkey.replace(/\s+/g,"").toUpperCase().split("+"),i,c;for(i=0,c=keys.length;i<c;i++){if(keys[i]=="CTRL"){ret.ctrlKey=true}else if(keys[i]=="ALT"){ret.altKey=true}else if(keys[i]=="SHIFT"){ret.shiftKey=true}else if(/^[A-Z0-9]$/.test(keys[i])){ret.keyCode=keys[i].charCodeAt(0)}else{ret.keyCode=$.hotkey.specialKeys[keys[i]]||null}}return ret.keyCode===null?false:ret}function serialize(objHotkey){var arr=[];if(objHotkey.ctrlKey)arr.push("CTRL");if(objHotkey.altKey)arr.push("ALT");if(objHotkey.shiftKey)arr.push("SHIFT");if(objHotkey.keyCode)arr.push(getSpecialKey(objHotkey.keyCode)||String.fromCharCode(objHotkey.keyCode));return arr.join("+")}function getSpecialKey(code){for(var k in $.hotkey.specialKeys){if(code==$.hotkey.specialKeys[k])return k}return false}function keyHandler(event){var $this=$(this),handlers=$this.data("hotkey-handlers"),strHotkey=serialize(event);if(!handlers||!(strHotkey in handlers))return;handlers[strHotkey].call(this,event)}})(jQuery);$(function(){Fancy.init()});$("#filter").each(function(){var filter=$(this);filter.find("h3").parent().find("a").click(function(){filter.toggleClass("expanded").find("em").text($(this).text());location.href=$(this).attr("href");return false})});window.show_overlay_on_timeline=function(){$("#content").delegate(".figure-product",{mouseover:function(){var $this=$(this),$timeline=$this.find(".timeline");if(!$timeline.length)return;var $img=$this.find("img"),pos=$img.position(),w=$img.width(),h=$img.height();if(w>640)w=640;$timeline.filter(":hidden").css("opacity",0).end().show().stop().css({width:w-54+"px",height:h-12+"px",top:pos.top+"px",left:pos.left+"px"}).fadeTo(200,1);if(h<110)$timeline.find(".btn-share").hide()},mouseleave:function(event){var $timeline=$(this).find(".timeline").stop().fadeTo(100,0,function(){$timeline.hide()})}})};show_overlay_on_timeline();(function($){function sameOrigin(url){var host=location.host;var protocol=location.protocol;var sr_origin="//"+host;var origin=protocol+sr_origin;return url==origin||url.slice(0,origin.length+1)==origin+"/"||(url==sr_origin||url.slice(0,sr_origin.length+1)==sr_origin+"/")||!/^(\/\/|https?:).*/.test(url)}$.ajaxPrefilter(function(options,originalOptions,jqXHR){if(/^(POST|PUT|DELETE)$/i.test(options.type)&&sameOrigin(options.url)){var v=$.cookie.get("csrftoken");if(v&&v.length){if(!options.headers)options.headers={};options.headers["X-CSRFToken"]=v}if(!/[&\?]_=\d+/.test(options.url)){options.url+=(options.url.indexOf("?")>0?"&":"?")+"_="+(new Date).getTime()}}})})(jQuery);jQuery(function($){$(".giftgroup .figure-product img").css("opacity",0).load(function(){var $this=$(this),$div=$this.closest(".figure-product");if(this.width>this.height){$this.height("100%").css("margin-left",parseInt(($div.width()-$this.width())/2)+"px")}else{$this.width("100%").css("margin-top",parseInt(($div.height()-$this.height())/2)+"px")}$this.fadeTo(500,1)}).each(function(){if(this.width&&this.height)$(this).trigger("load")})});(function($){var options;var defaults={dataKey:"",loaderSelector:"#infscr-loading",itemSelector:"#content .inside-content .figure-row",nextSelector:"a.btn-more",streamSelector:".stream",prepare:4e3,prefetch:false,newtimeline:false,dataType:"html",success:function(data){},error:function(){},comeplete:function(xhr,st){}};$.infiniteshow=function(opt){options=$.extend({},defaults,opt);var $win=$(window),$doc=$(document),ih=$win.innerHeight(),$url=$(options.nextSelector).hide(),$str=$(options.streamSelector),loc=$str.attr("loc"),url=$url.attr("href"),bar=$("div.pagination"),ttl=5*60*1e3,calling=false;prefetching=false;ignorePrefecth=false;lastFetchedUrl=null;var keys={timestamp:"fancy."+options.dataKey+".timestamp."+loc,stream:"fancy."+options.dataKey+".stream."+loc,latest:"fancy."+options.dataKey+".latest."+loc,nextURL:"fancy."+options.dataKey+".nexturl."+loc,prefetch:"fancy.prefetch.stream."+loc};(function(){if(!options.dataKey)return;var data=$.jStorage.get(keys.stream,""),latest=$.jStorage.get(keys.latest,""),nextURL=$.jStorage.get(keys.nextURL,""),timestamp=$.jStorage.get(keys.timestamp,0);$.jStorage.deleteKey(keys.prefetch);if(!data||!nextURL||+new Date-timestamp>ttl){for(var name in keys)$.jStorage.deleteKey(keys[name]);return}$url.attr("href",url=nextURL);$str.html(data);if(latest)$str.attr("ts",latest);if(options.prefetch)prefetch(nextURL);var tids=[],items={};$(options.itemSelector).slice(-100).each(function(){var $btn=$(this).find(".button.fancy,.button.fancyd"),tid=$btn.attr("tid");if(tid){tids.push(tid);items[tid]=$btn}});if(!tids.length)return;$.ajax({type:"POST",url:"/user_fancyd_things.json",data:{object_ids:tids.join(",")},dataType:"json",success:function(json){var fancyd={},$btn;for(var i=0,c=json.length;i<c;i++){fancyd[json[i].object_id]=json[i].id}for(var k in items){if(fancyd[k]){$btn=items[k].find(".button.fancy");if($btn.length)$btn.toggleClass("fancy fancyd").attr("rtid",fancyd[k]).contents().get(-1).nodeValue=gettext("Fancy'd")}else{$btn=items[k].find(".button.fancyd");if($btn.length)$btn.toggleClass("fancy fancyd").removeAttr("rtid").contents().get(-1).nodeValue=gettext("Fancy")}}}})})();function docHeight(){var d=document;return Math.max(d.body.scrollHeight,d.documentElement.scrollHeight)}function prefetch(url){prefetching=true;if(!url||typeof url=="object")url=$url.attr("href");if(url==lastFetchedUrl){$.jStorage.deleteKey(keys.prefetch);prefetching=false;return}lastFetchedUrl=url;$.ajax({url:url,dataType:options.dataType,success:function(data,st,xhr){if(!ignorePrefecth)$.jStorage.set(keys.prefetch,data,{TTL:ttl});ignorePrefecth=false;prefetching=false},error:function(xhr,st,err){$.jStorage.deleteKey(keys.prefetch);ignorePrefecth=false;prefetching=false}})}function onScroll(){url=$url.attr("href");if(!url){$url=$(options.nextSelector).hide();url=$url.attr("href")}if(calling||!url||options.disabled)return;calling=true;var rest=docHeight()-$doc.scrollTop();if(rest>options.prepare){calling=false;return}var $loader=$(options.loaderSelector).show();function appendThings(data){if(options.disabled){$.jStorage.deleteKey(keys.prefetch);return}var $sandbox=$("<div>"),$contentBox=$(options.itemSelector).parent(),$next,$rows;$sandbox[0].innerHTML=data.replace(/^[\s\S]+<body.+?>|<((?:no)?script|header|nav)[\s\S]+?<\/\1>|<\/body>[\s\S]+$/gi,function(match,$1){if($1=="script"&&$(match).attr("type")=="application/json"){return match}else{return""}});$next=$sandbox.find(options.nextSelector);$rows=$sandbox.find(options.itemSelector);$contentBox.append($rows);if($next.length){url=$next.attr("href");$url.attr({href:$next.attr("href"),ts:$next.attr("ts")});if(options.prefetch)prefetch($next.attr("href"))}else{url="";$url.attr({href:"",ts:""})}if(!options.newtimeline)$win.trigger("savestream.infiniteshow");onScroll();if(options.post_callback!=null){options.post_callback($rows)}$("<style></style>").appendTo($(document.body)).remove()}if(options.prefetch&&!prefetching&&(data=$.jStorage.get(keys.prefetch))){$.jStorage.deleteKey(keys.prefetch);appendThings(data);calling=false;$loader.hide()}else{if(prefetching){calling=false;setTimeout(onScroll,300);return}$.jStorage.deleteKey(keys.prefetch);$.ajax({url:url,dataType:options.dataType,success:function(data,st,xhr){appendThings(data)},error:function(xhr,st,err){url=""},complete:function(){calling=false;$loader.hide()}})}}$win.off("resize.infiniteshow").on("resize.infiniteshow",function(){ih=$win.innerHeight();onScroll()});$win.off("scroll.infiniteshow").on("scroll.infiniteshow",onScroll);$win.off("savestream.infiniteshow").on("savestream.infiniteshow",function(){loc=$str.attr("loc");if(!$str.length||!options.dataKey)return;var keys={timestamp:"fancy."+options.dataKey+".timestamp."+loc,stream:"fancy."+options.dataKey+".stream."+loc,latest:"fancy."+options.dataKey+".latest."+loc,nextURL:"fancy."+options.dataKey+".nexturl."+loc};var data=$str.html().replace(/>\s+</g,"><");$.jStorage.set(keys.timestamp,+new Date,{TTL:ttl});$.jStorage.set(keys.stream,data,{TTL:ttl});$.jStorage.set(keys.latest,$str.attr("ts"),{TTL:ttl});$.jStorage.set(keys.nextURL,url,{TTL:ttl})});$win.off("prefetch.infiniteshow").on("prefetch.infiniteshow",prefetch);$win.unload(function(){$.jStorage.deleteKey(keys.prefetch)});onScroll();$.infiniteshow.option=function(name,value){if(typeof value=="undefined")return options[name];options[name]=value;if(name=="disabled"&&!value)onScroll()}}})(jQuery);(function($){$(".sign-wrap input").focus(function(){$(this).closest("span").addClass("focus")}).blur(function(){$(this).closest("span").removeClass("focus")})})(jQuery);(function($){var $links=$("a.mn-browse,a.mn-you,a.mn-help,a.mn-gifts");$links.on("focus",function(){if($(this).closest("li.gnb").hasClass("active"))return;this.parentNode.className="gnb hover"}).on("blur",function(){if($(this).closest("li.gnb").hasClass("active"))return;this.parentNode.className="gnb"}).on("touchstart",function(){if(this.parentNode.className=="gnb hover"){return true}else{this.focus();return false}})})(jQuery);jQuery(function($){$(".user-section .social-accounts a,.user-section .vcard .fn a").each(function(){var tool=$(this).find(".tooltip");$(this).mouseover(function(){$(tool).css("margin-left",-($(tool).width()/2)-7+"px")})});$(".container > .banner_  .close_").click(function(event){event.preventDefault();var $this=$(this),cookie_name=$this.attr("rel"),expires=new Date;$this.closest(".banner_").hide();expires.setDate(expires.getDate()+14);document.cookie=cookie_name+"=true; path=/; expires="+expires.toUTCString()});$(".gift-banner.recommend_ .btn-rnd-blue").click(function(event){event.preventDefault();$(".gift-recommend").show()});$(".gift-banner.guide_ .btn-rnd-blue").click(function(event){event.preventDefault();location.href="/gifts/index"});$("#content,#slideshow-box").delegate("span.daily","mouseenter",function(){$(this).find("em").css("margin-left",-$(this).find("em").width()/2-8+"px").show();$(this).find("small").css("margin-left",-$(this).find("small").width()/2-8+"px").show()});$("#content,#slideshow-box").delegate("span.daily","mouseleave",function(){$(this).find("em, small").hide()});$("#slideshow-box").delegate(".share","click",function(e){$.dialog("share-new").open()});(function(){var $popup=$(".gift-recommend");$(".menuitem-gift-recommend").click(function(event){event.preventDefault();$.dialog("gift-recommend").open();return false});$popup.find(".btn-share").click(function(event){event.preventDefault();var gender=$(this).parents(".gift-recommend").find("#gift-for").val();var category=$(this).parents(".gift-recommend").find("#gift-cat").val();var price=$(this).parents(".gift-recommend").find("#gift-price").val();var txt_area=$(this).parents(".gift-recommend").find("textarea");var default_txt=txt_area.attr("placeholder");var txt=txt_area.val();if(txt==default_txt||txt.length<20){alertify.alert(gettext("Please give us some more details so we can help you find an amazing gift!"));return false}$.ajax({url:"/ask_gift_expert.json",type:"post",data:{text:txt,gender:gender,category:category,price:price},dataType:"json",success:function(json){if(json.status_code==1){alertify.alert(json.message);$.dialog("gift-recommend").close();$(".gift-banner .close_").click()}else{alertify.alert(json.message)}}})}).end()})();(function(){var $nb=$("#notification-bar"),$fg=$nb.find(">div.for-general"),uid=$fg.attr("uid"),$ir=$("#invitation-reminder");if(!$fg.length)return;if($ir.length&&$ir.is(":visible"))return;if(document.cookie.match(new RegExp("\\b"+uid+"=1")))return;var $container=$("#header~.container:first").animate({"padding-top":"+=55px"},"fast");$nb.find(">div").hide().end().find(">div.for-general").show().end().slideDown("fast").find("button.close").click(function(){$nb.slideUp("fast").filter(":not(.top)").parent({"padding-top":"-=20px"},"fast");$container.animate({"padding-top":"-=55px"},"fast");var expire=new Date;expire.setDate(expire.getDate()+7);document.cookie=uid+"=1; path=/; expires="+expire.toUTCString()}).end().filter(":not(.top)").parent().animate({"padding-top":"+=20px"},"fast")})();(function(){var sending=false;$("#notibar-email-confirm a:not([href])").click(function(event){var $this=$(this).attr("href","#");event.preventDefault();if(sending)return;sending=true;$.ajax({type:"post",url:"/send_email_confirmation.json",data:{resend:true},success:function(response){if(typeof response.status_code=="undefined")return;if(response.status_code==1){$this.parent().css("opacity","0").css("opacity","1").html(gettext("Success! You should receive a new confirmation email soon."));setTimeout(function(){$(".notify-default").slideUp();$("#container-wrapper").animate({"padding-top":"0"})},2e3)}else if(response.status_code==0){if(response.message)alertify.alert(response.message)}},complete:function(){sending=false}})})})();(function(){$("#lang_popup").delegate("a[href][class!=mn-lang]","click",function(event){if($(this).hasClass("btn-add")==false){event.preventDefault();
var $this=$(this),lang=$this.attr("href").substring(1);$.cookie.set("lang",lang,14);location.reload()}})})()});jQuery(function($){var $container=$("#popup_container"),prev_dialog=null,duration=300,distance=100,container_h;var $win=$(window),$body=$("body");$container.on("click",function(event){if($container.hasClass("edit_shipping_addr")==false&&$container.hasClass("checkout-payment")==false&&event.target===this&&prev_dialog){if($container.hasClass("create_po")==true){var ans=confirm("You haven't finished PO yet. Do you want to leave without finishing? Are you sure you want to close this popup?");if(ans==true){event.preventDefault();prev_dialog.close()}}else if(!$container.hasClass("update-browser")){event.preventDefault();prev_dialog.close()}}}).delegate(".ly-close,.btn-close,.btn-cancel","click",function(event){if($container.hasClass("create_po")==true){var ans=confirm("You haven't finished PO yet. Do you want to leave without finishing? Are you sure you want to close this popup?");if(ans==true){event.preventDefault();if(prev_dialog)prev_dialog.close()}}else{event.preventDefault();if(prev_dialog)prev_dialog.close()}});$body.on("keyup.popup",function(event){if(event.keyCode==27&&prev_dialog)prev_dialog.close()});$.dialog=function(popup_name){var $popup=$container.find(">."+popup_name);return{name:popup_name,$obj:$popup,loading:function(){var $c=$container.addClass(popup_name).show();setTimeout(function(){$c.css("opacity",1)},1);this.$obj.hide();prev_dialog=this;$container.data("lastest_popup_name",popup_name);$container.find(".loader").show();return this},open:function(){if(prev_dialog&&prev_dialog.name==this.name){return}var $c,h,mt,sc=$win.scrollTop();$("html").addClass("fixed");var that=this;var that_arguments=arguments;if(!container_h)container_h=Math.min($container.height(),$win.innerHeight());var after_close;after_close=function(){if(Modernizr.csstransitions&&that.$obj.attr("popup-slide")=="top"){that.$obj.css("top","-200%");that.$obj.css("transition","top 0.5s");that.$obj.css("-webkit-transition","top 0.5s");that.$obj.css("-moz-transition","top 0.5s");that.$obj.css("-o-transition","top 0.5s");setTimeout(function(){that.$obj.css("top","0%")},0)}if($win.innerHeight()<$body[0].scrollHeight){$container.css("top",-sc+"px")}$container.find(".loader").hide();$c=$container.addClass(popup_name).show().data("scroll-top",sc);that.center().$obj.show().trigger("open",that_arguments).show().siblings(".popup").css("display","");if($c.length){setTimeout(function(){$c.css("opacity",1)},1);$("#container-wrapper > .container").css("top",-sc+"px");$win.scrollTop(0)}prev_dialog=that;$container.data("lastest_popup_name",popup_name);that.$obj.off("transitionend",after_close);return that};if(prev_dialog)prev_dialog.close(true,after_close);else after_close();return this},close:function(keep_container,callback){if(!this.showing()||!this.can_close())return;var that=this;var after_close;var immediate_close=true;if(that.$obj.attr("popup-slide")=="top"){immediate_close=false}after_close=function(){$container.find(".loader").hide();$c=$container.eq(keep_container?1:0).end();$("html").removeClass("fixed");$container.css("top","0px");if(keep_container){$container.removeClass(popup_name)}else{$("#container-wrapper > .container").css("top",0);$win.scrollTop($c.data("scroll-top"));if(Modernizr.csstransitions&&immediate_close){$container.css("opacity",0);setTimeout(function(){$container.removeClass(popup_name).hide()},duration+100)}else{$container.removeClass(popup_name).hide()}}prev_dialog=null;$popup.trigger("close").hide();that.$obj.off("transitionend",after_close);if(callback===undefined||callback===null){}else{callback()}};if(Modernizr.csstransitions&&that.$obj.attr("popup-slide")=="top"){that.$obj.css("top","0%");that.$obj.css("transition","top 0.5s");that.$obj.css("-webkit-transition","top 0.5s");that.$obj.css("-moz-transition","top 0.5s");that.$obj.css("-o-transition","top 0.5s");if(!keep_container)$container.css("opacity",0);setTimeout(function(){that.$obj.css("top","-200%")},0);that.$obj.on("transitionend",after_close)}else{after_close()}return this},center:function(return_value){var mt;if(this.$obj.attr("popup-align")=="top"){mt=0}else{mt=Math.max(Math.floor((container_h-this.$obj.outerHeight())/2)+(+this.$obj.attr("data-offset")||0)-20,5);if($popup.attr("data-margin-top"))mt=$popup.attr("data-margin-top")}if(return_value)return mt;var ml=$(window).width()-$popup.width();this.$obj.css({"margin-top":mt+"px",marginLeft:ml/2+"px"});return this},showing:function(){return $container.is(":visible")&&$container.hasClass(popup_name)},can_close:function(){return true}}};var resize_timer=null;$win.on("resize",function(){clearTimeout(resize_timer);resize_timer=setTimeout(function(){container_h=$win.innerHeight();if(prev_dialog)prev_dialog.center()},100)});var m=/MSIE ([\d\.]+)/.exec(navigator.userAgent);if(m&&parseInt(m[1])<9){$("body").addClass("ie")}});jQuery(function($){var $fancy_share=$("#fancy-share"),dlg_share=$.dialog("share-new");$("#content,#sidebar,#summary").delegate(".timeline .btn-share,.figure-item .btn-share, #show-someone","click",function(event){event.preventDefault();$fancy_share.trigger("open_thing",this)}).delegate(".btn-comment-share","click",function(event){event.preventDefault();$fancy_share.trigger("open_comment",this)}).delegate(".btn-list-share","click",function(event){event.preventDefault();$fancy_share.trigger("open_list",this)}).delegate(".btn-gift-share","click",function(event){event.preventDefault();$fancy_share.trigger("open_gift",this)}).delegate(".btn-user-share","click",function(event){event.preventDefault();$fancy_share.trigger("open_user",this)}).delegate(".btn-seller-share","click",function(event){event.preventDefault();$fancy_share.trigger("open_seller",this)});var $frm=$fancy_share.find("dd.email-frm"),$name=$frm.find("b.name").remove(),$list=$fancy_share.find("ul.user-list"),$item=$list.find(">li").remove(),$add=$frm.find(".add"),$inp=$frm.find("input:text"),txt_add=$add.text().split("|"),timer,xhr,prev_val="";$add.text(txt_add[0]);$frm.click(function(event){if($(event.target).is("span.add,dd.email-frm")){if(!$frm.find("b.name").length){$add.hide();$inp.show().val("").focus();prev_val="";return false}}});function request_username(val,cursor,oncomplete){try{if(xhr&&xhr.abort)xhr.abort()}catch(e){}cursor=cursor||1;xhr=$.ajax({type:"get",url:"/search-users.json",data:{term:val,cursor:cursor,check_messages_permission:true,filter_messages_permission:true},dataType:"json",success:function(json){if(val!=$.trim($inp.val()))return;var list=[],exists={},i,c;$frm.find(">b.name[uid]").each(function(){exists[this.getAttribute("uid")]=true});if(json&&json.list&&json.list.length){for(i=0,c=json.list.length;i<c;i++){if(!exists[json.list[i].id])list.push(json.list[i])}}if(list.length){if(json.next)list.next=json.next;add_items(list);$list.show().find(">li:first").addClass("on")}else if(cursor==1){$list.hide()}},complete:oncomplete||$.noop})}function add_items(list){var $more=$list.find(">li.load-more");for(var i=0,c=list.length;i<c;i++){$item.clone().attr("uid",list[i].id).attr("username",list[i].username).find("img").attr("src",list[i].image_url).end().find("b").text(list[i].name||list[i].username).end().find("small").text("@"+list[i].username).end().appendTo($list)}if(list.next){if(!$more.length)$more=$('<li class="load-more"><span>'+gettext("Load more...")+"</span></li>");$more.data("cursor",list.next).appendTo($list)}else{$more.remove()}}$inp.on("changed",function(){var v=$.trim($inp.val());if(!v.length)return $list.hide();$list.hide().html("");request_username(v)}).blur(function(){var v=$.trim($inp.val());if(!$frm.find("b.name").length){$add.show()}$list.hide();$inp.hide().val("")}).keydown(function(event){setTimeout(function(){var val=$.trim($inp.val());if(val==prev_val)return;prev_val=val;$inp.trigger("changed")},10);switch(event.keyCode){case 8:if($inp.val().length!=0)return true;var $names=$frm.find("b.name");if($names.length>0)$names.eq(-1).remove();return false;case 9:case 13:case 186:case 188:if(event.keyCode==9&&$list.is(":hidden"))return true;$list.trigger("key.enter");return false;case 38:$list.trigger("key.up");return false;case 40:$list.trigger("key.down");return false}});$list.on("key.up key.down",function(event){if($list.is(":hidden"))return false;var $items=$list.children("li"),up=event.namespace=="up",idx=Math.min(Math.max($items.filter(".on").index()+(up?-1:1),0),$items.length-1);var $on=$items.removeClass("on").eq(idx).addClass("on"),bottom;if(up){if(this.scrollTop>$on[0].offsetTop)this.scrollTop=$on[0].offsetTop}else{bottom=$on[0].offsetTop-this.offsetHeight+$on[0].offsetHeight;if(this.scrollTop<bottom)this.scrollTop=bottom}}).on("key.enter",function(){$list.filter(":visible").children("li.on").mousedown()}).delegate("li:not(.load-more)","mousedown",function(){var $item=$(this);$name.clone().prepend(document.createTextNode($item.find("b").text())).attr("uid",$item.attr("uid")).attr("username",$item.attr("username")).insertBefore($add);$add.hide();setTimeout(function(){$inp.val("");$frm.click()},10);$list.hide()}).delegate("li.load-more","mousedown",function(){var $this=$(this);$this.addClass("loading");request_username($.trim($inp.val()),$this.data("cursor"),function(){$this.removeClass("loading")});return false});$fancy_share.on("reset",function(){var $this=$(this);$this.data({url:"",txt:"",img:""}).removeClass("list-share thing-share gift-share comment-share user-share").children(".link,.embed,.anywhere,.email,.btn-area").css("display","").end().find("textarea").val("").end()}).on("open_comment",function(event,btn){var $this=$(this).trigger("reset").addClass("comment-share"),$btn=$(btn),$li=$btn.closest("li.comment"),el_cmt=$li.children("p.c-text"),txt_cmt=el_cmt.text(),url,txt;uimage=$li.attr("uimage");username=$li.attr("cuname");fullname=$li.attr("fullname");$this.find("#share-link-input").val(url).end().find(".bio").html(txt_cmt).end().find(".fig-info").find("h4").text(fullname).end().find(".from").text(username).end().end().data({url:url="http://"+location.host+$btn.closest("a").attr("href"),txt:txt=txt_cmt+" - "+username,img:$btn.data("timage")});if($this.data("prev")!="comment-"+username)$this.find(".thum>img").attr("src","/_ui/images/common/blank.gif").attr("src",uimage);$this.data("prev","comment-"+username);$.ajax({type:"post",url:"/get_comment_short_url.json",data:{thing_id:$li.closest(".comments").attr("data-tid"),comment_id:$li.attr("cid")},dataType:"json",success:function(json){if(!json.short_url)return;var enc_short_url=encodeURIComponent(json.short_url);$this.find("#share-link-input").val(json.short_url).end().find(".share-via a[href]").each(function(){this.setAttribute("href",this.getAttribute("href").replace(/([\?&]u(?:rl))=[^&]+/,"$1="+enc_short_url))}).end()}});dlg_share.open()}).on("open_thing",function(event,btn){var $btn=$(btn);if($.isFunction($btn.data("updateAttrs"))){$btn.data("updateAttrs")()}var $this=$(this).trigger("reset").addClass("thing-share"),tid=$btn.attr("tid"),tuser,uname=$this.attr("uname"),ref="",url,tname,tdescription,img,iframe_h,thing_path,price,reacts,fancy_cnt;var login_require=$btn.attr("require_login");if(login_require&&login_require=="true"){$.dialog("popup.sign.signup").open();return false}function setInfo(){var str="";if(tname)$this.find("span.figcaption").text(tname);if(tdescription){$this.find("p.description").text(tdescription).show().end().find("div.fig").addClass("description")}else{$this.find("p.description").text("").hide().end().find("div.fig").removeClass("description")}if(price)str+="<b>$"+price+"</b>";if(tuser)str+=(str?"":"")+'<a href="/'+tuser+'">'+tuser+"</a>";if(fancy_cnt)str+=" + "+fancy_cnt;else if(reacts)str+=" + "+reacts+" "+(reacts>1?"others":"other");if(str)$this.find(".fig-info > .username").html(str)}function setAnywhere(img){var tag='<a href="'+$this.data("url")+'">';tag+='<img src="'+img.src+'" class="fancy-id-'+tid+'" alt="'+tname+'"';if(img.width!=null&&img.height!=null){tag+=' width="'+img.width+'" height="'+img.height+'"'}tag+="></a>";$("#share-anywhere").val(tag)}function setEmbed(img){if(!img.width||!img.height)return;$this.find(".embed").data("ratio",img.height/img.width).find(".width_").val(img.width+32).attr("max",img.width+32).end().trigger("update")}function retrieveImgSize(imgRef){var _img=new Image;_img.onload=function(){imgRef.width=_img.width;imgRef.height=_img.height};_img.src=imgRef.src}img=$btn.parent().prev("img").get(0);var imgRetrievalStrategies=[function(){var fig=$btn.closest(".figure-item").find(".figure[data-ori-url]");img=fig.size()>0?{src:fig.data("ori-url")}:null;if(img){retrieveImgSize(img)}},function(){img=$btn.closest(".figure-item").find(".figure > img").get(0)},function(){img=$(".fig-image > img").get(0)},function(){img=$("#slideshow figure .img-wrap img").get(0)},function(){var src=$(".figure-item .figure").eq(0).css("background-image").replace("url(,","").replace(")","");if(src&&src!=="none"){img={src:src};retrieveImgSize(img)}},function(){var fig=$("figure > span.figure[data-ori-image]");if(fig.size()>0){img={src:data("ori-image"),width:data("ori-width"),height:data("ori-height")}}else{img={src:""}}}];for(var i=0;!img&&i<imgRetrievalStrategies.length;i++){imgRetrievalStrategies[i]()}tuser=$btn.attr("tuser");if(!tuser)tuser=$btn.closest(".figure-item").find(".username a").text();price=$btn.attr("price");if(!price)price=$btn.closest(".figure-item").find(".price").text().replace(/[^\d\., ]+/g,"");price=$.trim(price);reacts=$btn.attr("reacts");if(!reacts){reacts=$btn.closest(".figure-item").find(".figure-detail em").text().match(/\+ (\d+)/);if(reacts)reacts=reacts[1]}$this.find(">ul.tab").nextUntil("button.ly-close").hide().end().find("li > a:first").click();thing_path=$btn.attr("turl")||($btn.closest("a").attr("href")||"").replace(/^#.*$/,"");if(!thing_path){if(/^\/things\/\d+/.test(location.pathname)){thing_path=location.pathname}else{thing_path=$btn.closest("div.figure-item").find("a.figure-img").attr("href")}}if(uname)ref="?ref="+uname;tdescription=$btn.attr("tdescription");fancy_cnt=$btn.attr("fancy_cnt");$this.data({url:url="http://"+location.host+thing_path+ref,txt:tname=$btn.attr("tname"),img:$btn.data("timage")}).attr({otype:"nt",tid:tid,turl:url,tname:tname,tdescription:tdescription,ooid:$btn.attr("uid")}).find("#share-link-input").val(url).end().find(".embed").trigger("update").end();if($this.data("prev")!="thing-"+tid)$this.find(".thum>img").attr("src","/_ui/images/common/blank.gif").attr("src",$btn.attr("timage"));$this.data("prev","thing-"+tid);setInfo();$this.find(".embed").find("input:checkbox").prop("checked",true).end();setEmbed(img);setAnywhere(img);$('<img style="position:absolute;left:-9999px;top:-9999px">').load(function(){setEmbed(this);setAnywhere(this);$(this).remove()}).attr("src",img.src).appendTo("body");$.ajax({type:"post",url:"/get_short_url.json",data:{thing_id:tid},dataType:"json",success:function(json){if(!json.short_url)return;var enc_short_url=encodeURIComponent(json.short_url);$this.find("#share-link-input").val(json.short_url).end().find(".share-via a[href]").each(function(){this.setAttribute("href",this.getAttribute("href").replace(/([\?&](?:u(?:rl)?|link))=[^&]+/,"$1="+enc_short_url))}).end().data("url",json.short_url+ref);setAnywhere(img);$this.trigger("get_short_url",[$btn,json.short_url])}});$.ajax({type:"get",url:"/get_short_url.json",data:{url:location.host+"/embed/v2/"+tid},dataType:"json",success:function(json){if(!json.short_url)return;$this.find(".embed").attr("short_url",json.short_url);setEmbed(img)}});dlg_share.open()}).on("open_list",function(event,btn){var $this=$(this).trigger("reset").addClass("list-share"),$btn=$(btn),id=$btn.attr("lid"),oid=$btn.attr("loid"),url,$imgs,images=[];url=$btn.attr("href");if(url.indexOf("http://")<0)url="http://"+location.host+url;$this.data({url:url,txt:list_name=$btn.attr("list_name")}).find(".fig-info").find("h4").text(list_name).end().find(".from").html($("#list-author-"+id).html()).end().end().find("#share-link-input").val(url).end();$imgs=$("#list-thumbnails-"+id+" .fig-image > img, #list-thumbnails-"+id+" li[tid] .figure.vertical > img");if($imgs.length){$thumb=$('<div class="thumbnails" />').appendTo($this.find(".fig-info"));for(var i=0,c=Math.min($imgs.length,3);i<c;i++){$thumb.append("<span style=\"background-image:url('"+$imgs.get(i).src+"')\">")}}else{$this.find(".fig-info .thumbnails").remove()}if(!/^http:\/\/fancy\.to/.test(url)){$.ajax({type:"POST",url:"/get_list_short_url.json",data:{list_id:id,owner_id:oid},dataType:"json",success:function(json){if(!json.short_url)return;var enc_short_url=encodeURIComponent(json.short_url);$this.find("#share-link-input").val(json.short_url).end().find(".share-via a[href]").each(function(){this.setAttribute("href",this.getAttribute("href").replace(/([\?&]u(?:rl))=[^&]+/,"$1="+enc_short_url))}).end()}})}dlg_share.open()}).on("open_gift",function(event,btn){var $this=$(this).trigger("reset").addClass("gift-share"),$btn=$(btn),url;$this.data({url:url=$btn.attr("href"),txt:$btn.attr("gift_name")}).find("#share-link-input").val(url);dlg_share.open()}).on("open_user",function(event,btn){var $this=$(this).trigger("reset").addClass("comment-share user-share"),$btn=$(btn),url;$this.data({url:url=$btn.attr("href"),txt:$btn.attr("txt")}).find("#share-link-input").val(url).end().find(".share-user").text($this.find(".share-user").text().replace(/\{\{name\}\}/g,$btn.attr("username")));dlg_share.open()}).on("open_seller",function(event,btn){var $this=$(this).trigger("reset").addClass("comment-share user-share"),$btn=$(btn),url;$this.data({url:url=$btn.attr("href"),txt:$btn.attr("txt")}).find("#share-link-input").val(url).end().find(".share-user").text("Share This Store");dlg_share.open()}).on("open",function(){var $this=$(this),url=$this.data("url"),txt=$this.data("txt"),img=$this.data("img"),amex=$this.data("amex"),enc_url,enc_txt,enc_img;enc_url=encodeURIComponent(url);enc_txt=encodeURIComponent(txt);enc_img=encodeURIComponent(img);if(amex)$this.data("amex","");$this.find(".section").css({marginTop:"",marginLeft:""}).end().find(">.popup-bg").one("click",function(){$this.trigger("hide")}).end().find(".share-via").find("a.tw").attr("href","http://twitter.com/share?text="+(amex?encodeURIComponent(amex):enc_txt)+"&url="+enc_url+"&via=fancy").data({width:540,height:300}).end().find("a.fb").attr("href","http://www.facebook.com/sharer.php?u="+enc_url).data({url:url,text:txt}).end().find("a.gg").attr("href","https://plus.google.com/share?url="+enc_url).end().find("a.su").attr("href","http://www.stumbleupon.com/submit?url="+enc_url+"&title="+enc_txt).end().find("a.tb").attr("href","http://www.tumblr.com/share/link?url="+enc_url+"&name="+enc_txt+"&description="+enc_txt).end().find("a.li").attr("href","http://www.linkedin.com/shareArticle?mini=true&url="+enc_url+"&title="+enc_txt+"&source=thefancy.com").end().find("a.vk").attr("href","http://vkontakte.ru/share.php?url="+enc_url).end().find("a.wb").attr("href","http://service.weibo.com/share/share.php?url="+enc_url+"&appkey=&title="+enc_txt+(img?"&pic="+enc_img:"")).end().find("a.mx").attr("href","http://mixi.jp/share.pl?u="+enc_url+"&k=91966ce7669c34754b21555e4ae88eedce498bf0").data({width:632,height:456}).end().find("a.qz").attr("href","http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url="+enc_url).end().find("a.rr").attr("href","http://share.renren.com/share/buttonshare.do?link="+enc_url+"&title="+enc_txt).end().find("a.od").attr("href","http://www.odnoklassniki.ru/dk?st.cmd=addShare&st.s=2&st.noresize=on&st._surl="+enc_url).end().end()}).on("close",function(){$frm.find("b.name").remove();$list.hide()}).on("click",".share-via li > a[href]:not(.fb,.gg)",function(event){var $this=$(this);event.preventDefault();var w=$this.data("width")||620,h=$this.data("height")||380,t=Math.max(Math.round((screen.availHeight-h-80)/2),20),l=Math.max(Math.round((screen.availWidth-w)/2),5);try{window.open($this.attr("href"),$this.attr("class"),"top="+t+",left="+l+",width="+w+",height="+h+",menubar=no,status=no,toobar=no,location=no,personalbar=no,scrollbars=no,resizable=yes").focus()}catch(e){}}).on("click",".share-via a.fb",function(event){var $this=$(this);event.preventDefault();var params={method:"feed",link:$this.closest(".popup").data("url")||$this.data("url"),name:$this.data("text"),caption:"",description:""};FB.ui(params,$.noop)}).on("mousedown",".ltit",function(event){var $h3=$(this),$dlg=$fancy_share.find(".section"),mt=parseInt($dlg.css("margin-top")),ml=parseInt($dlg.css("margin-left")),sx=event.clientX,sy=event.clientY;$(document).on("mousemove.share",function(event){var dx=event.clientX-sx,dy=event.clientY-sy;$dlg.css({marginTop:mt+dy+"px",marginLeft:ml+dx+"px"});return false}).on("mouseup.share",function(){$(document).unbind("mousemove.share moveup.share");return false});return false}).on("click","ul.tab a",function(event){event.preventDefault();var $this=$(this),cls=$this.attr("href").substr(1);$this.addClass("current").parent().siblings("li").find(">a").removeClass("current").end().end().closest(".tab").nextUntil("button.ly-close").css("display","").filter(cls).show()}).on("focus",".fig-info input:text",function(){var inp=this;setTimeout(function(){inp.select()},100)}).find("ul.user-list").delegate("li","mouseenter",function(){$(this).addClass("on")}).delegate("li","mouseleave",function(){$(this).removeClass("on")}).end().delegate("button.btn-del","click",function(){$(this).parent().remove();if($frm.find(">b.name").length==0)$add.show()}).on("click",".share-via > a.show",function(event){event.preventDefault();$(this).toggleClass("less").prev("ul").toggleClass("less");return false}).find(".embed").on("update",function(){var $this=$(this),type="",types={},tid=$fancy_share.attr("tid"),uname=$fancy_share.attr("uname"),html="",url,width,height,ratio=$this.data("ratio"),padding=32;$this.find("input:checkbox").each(function(){var id=this.id.replace(/^embed-/,""),$el=$this.find("."+id),key=this.getAttribute("key");$el.css("display",this.checked?"block":"");if(this.checked){type+=(type?",":"")+key;types[key]=true}});ratio=parseFloat(ratio);width=parseInt($this.find(".width_").val());if(isNaN(width)||!ratio){$this.find(".height_").val("")}else{height=Math.round(ratio*(width-padding))+padding+15+6;if(types.tt)height+=20;if(types.pr||types.by)height+=18;$this.find(".height_").val(height)}url=$this.attr("short_url");if(!url)url="http://"+location.hostname+"/embed/v2/"+tid;if(uname)url+="?ref="+uname;url+=(url.indexOf("?")<0?"?":"&")+"type="+type;if(width&&height){html='<iframe src="'+url+'" width="'+width+'" height="'+height+'" allowtransparency="true" frameborder="0" style="width:'+width+"px;height:"+height+'px;margin:0 auto;border:0"></iframe>'}$("#share-embed-input").val(html)}).on("keyup blur",".width_",function(event){var v=$.trim(this.value),min=200,max=this.getAttribute("max");if(!isNaN(v=parseInt(v))&&(event.type=="focusout"||event.type=="blur")){v=Math.max(Math.min(v,parseInt(max)),min);this.value=v}$(this).closest(".embed").trigger("update")}).on("click","input:checkbox",function(){$(this).closest(".embed").trigger("update")}).end().on("click","#share-link-input,#share-embed-input,#share-anywhere",function(){this.select()}).on("click",".btn-send,.btn-share",function(){var $this=$(this),params,emails=[],users=[],endpoint,otype=$fancy_share.attr("otype");$this.disable();$frm.find(">b.name").each(function(){var $b=$(this);if($b.attr("email")){emails.push($b.attr("email"))}else{users.push($b.attr("uid"))}});if(!emails.length&&!users.length){$this.disable(false);return false}if(otype=="gc"){params={type:"gc",url:$fancy_share.attr("gcurl"),name:$fancy_share.attr("gcname"),oid:$fancy_share.attr("gcid"),message:$.trim($fancy_share.find("textarea").val())};params.emails=emails.join(",");params.users=users.join(",");endpoint="/share-with-someone-gift.json"}else{params={things:$fancy_share.attr("tid"),user_id:users[0],message:$.trim($fancy_share.find(".email textarea").val())};endpoint="/messages/send-message.json"}$.ajax({type:"post",url:endpoint,data:params,dataType:"json",success:function(json){if(!json)return;if(json.status_code){$fancy_share.find(".alert-sent").fadeIn();setTimeout(function(){$("#fancy-share").find(".alert-sent").fadeOut().end().find(".email-frm").find("b.name").remove().end().find(".add").show().end().end().find(".email textarea").val("")},3e3)}else{alertify.alert(json.message)}},complete:function(){$this.disable(false)}})})});jQuery(function($){if("home_v3"in location.args)return;$.fn.shareLayer=function(){var $this=$(this);$this.off("reset").on("reset",function(){$this.data({url:"",txt:"",img:""}).find(".frm").find("small").hide().end().find(".sns").show().end().end().find(".share-tab").find("a").removeClass("current").end().find("a:first-child").addClass("current").end().end().find("input:text").val("").removeClass("val").end().find("textarea").val("").removeClass("val").end().find('input[name="embed_fa"]').attr("checked","checked").end().find(".btn_fa").show().end()}).off("open_thing").on("open_thing",function(){var $btn=$this.closest(".menu-container").find("button.share[tid]");if($.isFunction($btn.data("updateAttrs"))){$btn.data("updateAttrs")()}$this.trigger("reset");var tid=$btn.attr("tid"),tuser,uname=$this.attr("uname"),ref="",url,tname,tdescription,img,iframe_h,thing_path,price,reacts,fancy_cnt;var login_require=$btn.attr("require_login");if(login_require&&login_require=="true"){$.dialog("popup.sign.signup").open();return false}function setAnywhere(img){var tag='<a href="'+$this.data("url")+'">';tag+='<img src="'+img.src+'" class="fancy-id-'+tid+'" alt="'+tname+'"';if(img.width!=null&&img.height!=null){tag+=' width="'+img.width+'" height="'+img.height+'"'}tag+="></a>";$this.find("[name='share-anywhere']").val(tag)}function setEmbed(img){if(!img||!img.width||!img.height)return;$this.find(".embed").data("ratio",img.height/img.width).find(".width_").val(img.width+32).attr("max",img.width+32).end().trigger("update")}function retrieveImgSize(imgRef){var _img=new Image;_img.onload=function(){imgRef.width=_img.width;imgRef.height=_img.height};_img.src=imgRef.src}img=$btn.parent().prev("img").get(0);var imgRetrievalStrategies=[function(){var fig=$btn.closest(".figure-item").find(".figure[data-ori-url]");img=fig.size()>0?{src:fig.data("ori-url")}:null;if(img){retrieveImgSize(img)}},function(){img=$btn.closest(".figure-item").find(".figure > img").get(0)},function(){img=$(".fig-image > img").get(0)},function(){img=$("#slideshow figure .img-wrap img").get(0)}];for(var i=0;!img&&i<imgRetrievalStrategies.length;i++){imgRetrievalStrategies[i]()}tuser=$btn.attr("tuser");if(!tuser)tuser=$btn.closest(".figure-item").find(".username a").text();price=$btn.attr("price");if(!price)price=$btn.closest(".figure-item").find(".price").text().replace(/[^\d\., ]+/g,"");price=$.trim(price);reacts=$btn.attr("reacts");if(!reacts){reacts=$btn.closest(".figure-item").find(".figure-detail em").text().match(/\+ (\d+)/);if(reacts)reacts=reacts[1]}$this.find(">ul.tab").nextUntil("button.ly-close").hide().end().find("li > a:first").click();thing_path=$btn.attr("turl")||($btn.closest("a").attr("href")||"").replace(/^#.*$/,"");if(!thing_path){if(/^\/things\/\d+/.test(location.pathname)){thing_path=location.pathname}else{thing_path=$btn.closest("div.figure-item").find("a.figure-img").attr("href")}}if(uname)ref="?ref="+uname;tdescription=$btn.attr("tdescription");fancy_cnt=$btn.attr("fancy_cnt");$this.data({url:url="http://"+location.host+thing_path+ref,txt:tname=$btn.attr("tname"),img:$btn.data("timage")}).attr({otype:"nt",tid:tid,turl:url,tname:tname,tdescription:tdescription,ooid:$btn.attr("uid")}).find("#share-link-input").val(url).end().find(".embed").trigger("update").end();if($this.data("prev")!="thing-"+tid)$this.find(".thum>img").attr("src","/_ui/images/common/blank.gif").attr("src",$btn.attr("timage"));$this.data("prev","thing-"+tid);$this.find(".embed").find("input:checkbox").prop("checked",true).end();setEmbed(img);setAnywhere(img);$('<img style="position:absolute;left:-9999px;top:-9999px">').load(function(){setEmbed(this);setAnywhere(this);$(this).remove()}).attr("src",img.src).appendTo("body");$.ajax({type:"post",url:"/get_short_url.json",data:{thing_id:tid},dataType:"json",success:function(json){if(!json.short_url)return;var enc_short_url=encodeURIComponent(json.short_url);$this.find("#share-link-input").val(json.short_url).end().find(".share-via a[href]").each(function(){this.setAttribute("href",this.getAttribute("href").replace(/([\?&](?:u(?:rl)?|link))=[^&]+/,"$1="+enc_short_url))}).end().data("url",json.short_url+ref);setAnywhere(img);$this.trigger("get_short_url",[$btn,json.short_url])}});$.ajax({type:"get",url:"/get_short_url.json",data:{url:location.host+"/embed/v2/"+tid},dataType:"json",success:function(json){if(!json.short_url)return;$this.find(".embed").attr("short_url",json.short_url);setEmbed(img)}});$this.trigger("open")}).off("open").on("open",function(){var $this=$(this),url=$this.data("url"),txt=$this.data("txt"),img=$this.data("img"),amex=$this.data("amex"),enc_url,enc_txt,enc_img;enc_url=encodeURIComponent(url);enc_txt=encodeURIComponent(txt);enc_img=encodeURIComponent(img);if(amex)$this.data("amex","");$this.find(".sns .via").find("a.tw").attr("href","http://twitter.com/share?text="+(amex?encodeURIComponent(amex):enc_txt)+"&url="+enc_url+"&via=fancy").data({width:540,height:300}).end().find("a.fb").attr("href","http://www.facebook.com/sharer.php?u="+enc_url).data({url:url,text:txt}).end().find("a.gg").attr("href","https://plus.google.com/share?url="+enc_url).end().find("a.su").attr("href","http://www.stumbleupon.com/submit?url="+enc_url+"&title="+enc_txt).end().find("a.tb").attr("href","http://www.tumblr.com/share/link?url="+enc_url+"&name="+enc_txt+"&description="+enc_txt).end().find("a.li").attr("href","http://www.linkedin.com/shareArticle?mini=true&url="+enc_url+"&title="+enc_txt+"&source=thefancy.com").end().find("a.vk").attr("href","http://vkontakte.ru/share.php?url="+enc_url).end().find("a.wb").attr("href","http://service.weibo.com/share/share.php?url="+enc_url+"&appkey=&title="+enc_txt+(img?"&pic="+enc_img:"")).end().find("a.mx").attr("href","http://mixi.jp/share.pl?u="+enc_url+"&k=91966ce7669c34754b21555e4ae88eedce498bf0").data({width:632,height:456}).end().find("a.qz").attr("href","http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url="+enc_url).end().find("a.re").attr("href","http://share.renren.com/share/buttonshare.do?link="+enc_url+"&title="+enc_txt).end().find("a.od").attr("href","http://www.odnoklassniki.ru/dk?st.cmd=addShare&st.s=2&st.noresize=on&st._surl="+enc_url).end().end();$this.closest(".buttons").find(".menu-container").removeClass("opened").find(".show_share").show()}).off("close").on("close",function(){var $this=$(this);$this.find("small.email > input").val("").removeClass("error");$this.closest(".buttons").find(".menu-container").removeClass("opened").find(".show_share").hide().closest("li").removeClass("active")}).delegate(".sns .via a[href]:not(.fb,.gg,.more)","click",function(event){var $this=$(this);event.preventDefault();var w=$this.data("width")||620,h=$this.data("height")||380,t=Math.max(Math.round((screen.availHeight-h-80)/2),20),l=Math.max(Math.round((screen.availWidth-w)/2),5);try{window.open($this.attr("href"),$this.attr("class"),"top="+t+",left="+l+",width="+w+",height="+h+",menubar=no,status=no,toobar=no,location=no,personalbar=no,scrollbars=no,resizable=yes").focus()}catch(e){}}).delegate(".sns .via a.fb","click",function(event){var $this=$(this);event.preventDefault();var params={method:"feed",link:$this.closest(".popup").data("url")||$this.data("url"),name:$this.data("text"),caption:"",description:""};FB.ui(params,$.noop)}).find(".embed").off("update").on("update",function(){var $this=$(this),type="",types={},tid=$this.attr("tid"),uname=$this.attr("uname"),html="",url,width,height,ratio=$this.data("ratio"),padding=32;$this.find("input:checkbox").each(function(){var id=this.name.replace(/^embed-/,""),$el=$this.find("."+id),key=this.getAttribute("key");
$el.css("display",this.checked?"block":"");if(this.checked){type+=(type?",":"")+key;types[key]=true}});ratio=parseFloat(ratio);width=parseInt($this.find(".width_").val());if(isNaN(width)||!ratio){$this.find(".height_").val("")}else{height=Math.round(ratio*(width-padding))+padding+15+6;if(types.tt)height+=20;if(types.pr||types.by)height+=18;$this.find(".height_").val(height)}url=$this.attr("short_url");if(!url)url="http://"+location.hostname+"/embed/v2/"+tid;if(uname)url+="?ref="+uname;url+=(url.indexOf("?")<0?"?":"&")+"type="+type;if(width&&height){html='<iframe src="'+url+'" width="'+width+'" height="'+height+'" allowtransparency="true" frameborder="0" style="width:'+width+"px;height:"+height+'px;margin:0 auto;border:0"></iframe>'}$("#share-embed-input").val(html)}).end().delegate(".email .text","blur",function(event){if($(this).val()!=""||$(this).val()===$(this).attr("placeholder")){$(this).addClass("val").removeClass("placeholder")}}).delegate(".email .text","keypress",function(event){$(this).removeClass("placeholder")}).delegate(".email input:text","keyup",function(event){var $this=$(this);var email=$this.val();var oldEmailRegEx=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i;var emailRegEx=/^(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*)@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?)$/i;if(!emailRegEx.test(email)){$this.closest(".email").find(".btn-send").attr("disabled","disabled")}else{$this.closest(".email").find(".btn-send").removeAttr("disabled")}}).delegate(".btn-send, .btn-share","click",function(event){event.preventDefault();var $this=$(this),$fancy_share=$this.closest("em.show_share"),params,emails=[],users=[],endpoint,otype=$fancy_share.attr("otype");$this.disable();if(otype=="gc"){params={type:"gc",url:$fancy_share.attr("gcurl"),name:$fancy_share.attr("gcname"),oid:$fancy_share.attr("gcid"),message:$.trim($fancy_share.find("textarea").val())};endpoint="/share-with-someone-gift.json"}else{params={type:"nt",url:$fancy_share.attr("turl"),name:$fancy_share.attr("tname"),oid:$fancy_share.attr("tid"),ooid:$fancy_share.attr("ooid"),message:$.trim($fancy_share.find(".email textarea").val())};endpoint="/share-with-someone.json"}var email=$fancy_share.find("small.email > input").val();var oldEmailRegEx=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i;var emailRegEx=/^(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*)@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?)$/i;if(!emailRegEx.test(email)){$fancy_share.find("small.email > input").addClass("error");$this.disable(false);return false}emails.push(email);params.emails=emails.join(",");params.users=users.join(",");$.ajax({type:"post",url:endpoint,data:params,dataType:"json",success:function(json){if(!json)return;if(json.status_code){$this.trigger("close");alertify.alert("Sent!")}else{alertify.alert(json.message)}},complete:function(){$this.disable(false)}})});return $this};$("#content").delegate("button.share","click",function(event){$(this).closest(".buttons").find(".menu-container").removeClass("opened").find(".show_share").shareLayer().trigger("open_thing")})});jQuery(function($){var prev_val="";var $name=$('<b class="name"><button type="button" class="btn-del">Delete</button></b>');var $item=$('<i class="user"><a><img src="" /> <b>Hannah McDonald</b> <small>hannahmc</small></a></i>');var txt_add=null;$.fn.autoExpandWithMax=function(){var $ta=this,$clone,timer=null,mh=$ta.attr("min-height")||40;function resize(){var h=$clone.val($ta.val()).get(0).scrollHeight;var maxHeight=parseInt($ta.attr("max-height"));if(h>maxHeight){$ta.css("overflow","auto")}else{$ta.css("overflow","hidden")}var h=Math.min(maxHeight,Math.max(h,mh));$ta.css("height",h+"px")}function onkeydown(event){this.scrollTop=0;clearTimeout(timer);timer=setTimeout(resize,50)}$ta.nextAll("textarea").remove();if($clone)$clone.remove();$clone=$ta.clone().removeAttr("id").removeAttr("name").removeAttr("style").css({padding:0,margin:0}).addClass("no-effect").attr("tabindex","-1").insertAfter($ta);$ta.css("overflow","hidden").off("keydown.expand").on("keydown.expand",onkeydown);return $ta};$("#content").delegate(".btn-someone","click",function(event){event.preventDefault();if(!txt_add){txt_add=$(this).closest(".buttons").find(".show_someone .email-frm .add").text().split("|")}$(this).closest(".buttons").find(".show_someone").find(".success").hide().end().find(".frm, .email-frm").show().end().find(".email-frm b.name").remove().end().find("input:text").val("").end().find(".frm > .user-list i.user, .frm > .user-list i.load-more").remove().end().find(".frm > .user-list > i.result, .frm > .send.after").hide().end().find(".frm > .user-list > i.empty").show().end().find(".email-frm .add").text(txt_add[0]).show().end().find(".email-frm .text").attr("placeholder",txt_add[0]).end().find("textarea:eq(0)").val("").autoExpandWithMax();show_placeholder($(this).closest(".buttons").find(".show_someone"));$(this).closest(".buttons").find(".menu-container").removeClass("opened").find(".show_someone").show();$(this).closest(".buttons").find(".show_someone .user-list").off("scroll").on("scroll",function(){var $this=$(this);if($this.find("i.load-more:not(.loading)")[0]&&$this.scrollTop()+100>$this.find("i.load-more:not(.loading)").offset().top)$this.find("i.load-more:not(.loading)").mousedown();return false})}).delegate("em.show_someone","mouseover",function(event){if($(event.target).hasClass("trick")===false){if($("html").hasClass("fixed")===false){var sc=$(window).scrollTop();var ww=$("#container-wrapper").width();$("html").addClass("fixed");$("#container-wrapper").find(".container").css("top",-sc+"px").end().css("padding-right",$(window).width()-ww+"px");$("#header-new").css("padding-right",$(window).width()-ww+"px")}}}).delegate("em.show_someone .trick","mouseover",function(event){if($("html").hasClass("fixed")===true){var sc=$("#container-wrapper > .container").position().top;$("html").removeClass("fixed");$(window).scrollTop(-sc);$("#container-wrapper").find(".container").css("top","0px").end().css("padding-right","0");$("#header-new").css("padding-right","0px")}}).delegate("em.show_someone .email-frm","click",function(event){var $el=$(this).closest(".show_someone");$el.find(".email-frm").addClass("focus");$el.find(".add").hide();if($el.find(".add").text()==txt_add[0]){$el.find(".email-frm .text").show().focus()}show_placeholder($el);prev_val=""}).delegate("em.show_someone .email-frm input:text","changed",function(event){var v=$.trim($(this).val());var $list=$(this).closest(".show_someone").find(".user-list");if(!v.length||v.indexOf("@")>=0){try{if(xhr&&xhr.abort)xhr.abort()}catch(e){}$list.find("i.result").hide().end().find("i.user,i.load-more").remove();if(!v.length){show_placeholder($(this).closest(".show_someone"))}return}$list.find("i.user").remove();request_username($(this).closest(".show_someone"),v)}).delegate("em.show_someone .email-frm input:text","blur",function(event){var v=$.trim($(this).val());var $el=$(this).closest(".show_someone");var $add=$el.find(".add");var $list=$el.find(".user-list");if(v.indexOf("@")>=0){$name.clone().prepend(document.createTextNode(v)).attr("email",v).insertBefore($add);$add.text(txt_add[1]).hide();$(this).attr("placeholder",txt_add[1])}$el.find(".email-frm").removeClass("focus");if($add.text()==txt_add[0])$add.show();$(this).hide().val("");if(!$el.find(".email-frm b.name").length){$el.find(".frm .send.after").hide();show_placeholder($el)}}).delegate("em.show_someone .email-frm b.name .btn-del","click",function(event){var $el=$(this).closest(".show_someone");var uid=$(this).closest("b.name").attr("uid");$(this).closest("b.name").remove();if(uid){$el.find(".frm .user-list i[uid="+uid+"]").removeClass("on")}if(!$el.find(".email-frm b.name").length){$el.find(".frm .send.after").hide();$el.find(".email-frm .add").text(txt_add[0]).show();$el.find(".email-frm .text").attr("placeholder",txt_add[0]);show_placeholder($el)}}).delegate("em.show_someone .email-frm input:text","keydown",function(event){var v=$.trim($(this).val());var $inp=$(this);var $el=$(this).closest(".show_someone");var $add=$el.find(".add");var $list=$el.find(".user-list");setTimeout(function(){var val=$.trim($inp.val());if(val==prev_val)return;prev_val=val;$inp.trigger("changed")},10);switch(event.keyCode){case 8:if($inp.val().length!=0)return true;var $names=$el.find("b.name");if($names.length>0)$names.eq(-1).remove();if(!$el.find(".email-frm b.name").length){$el.find(".frm .send.after").hide();$el.find(".email-frm .add").text(txt_add[0]);$el.find(".email-frm .text").attr("placeholder",txt_add[0]);show_placeholder($el)}return false;case 9:case 13:case 32:case 186:case 188:if($inp.val().indexOf("@")>0){setTimeout(function(){var email=$.trim($inp.val());$inp.val("");$name.clone().prepend(document.createTextNode(email)).attr("email",email).insertBefore($add);$add.text(txt_add[1]).hide();$el.find(".email-frm .text").attr("placeholder",txt_add[1]).hide();$el.find(".frm > .send.after").show().end();$el.removeClass("hover")},10)}else{if(event.keyCode==9&&$list.is(":hidden"))return true;if(event.keyCode==32)return true;$list.trigger("key.enter")}return false;case 38:$list.trigger("key.up");return false;case 40:$list.trigger("key.down");return false}}).delegate("em.show_someone .user-list","key.up key.down",function(event){var $el=$(this).closest(".show_someone");var $list=$el.find(".user-list");if($list.is(":hidden"))return false;var $items=$list.children("i.user"),up=event.namespace=="up",idx=Math.min(Math.max($items.filter(".selected").index()-2+(up?-1:1),0),$items.length-1);var $on=$items.removeClass("selected").eq(idx).addClass("selected"),bottom;if(idx===$items.length-3){$el.addClass("hover")}else{$el.removeClass("hover")}if(up){if(this.scrollTop>$on[0].offsetTop)this.scrollTop=$on[0].offsetTop}else{bottom=$on[0].offsetTop-this.offsetHeight+$on[0].offsetHeight;if(this.scrollTop<bottom)this.scrollTop=bottom}}).delegate("em.show_someone .user-list","key.enter",function(event){var $el=$(this).closest(".show_someone");var $list=$el.find(".user-list");$list.filter(":visible").children("i.selected").mousedown()}).delegate("em.show_someone .user-list i.user:not(.load-more)","mousedown",function(event){var $el=$(this).closest(".show_someone");var $inp=$el.find("input:text");var $add=$el.find(".add");var $list=$el.find(".user-list");var $item=$(this);if($(this).hasClass("on")){$el.find("b.name[uid='"+$(this).attr("uid")+"'] .btn-del").click();return}if(!$add.is(":visible")){var uid=$el.find("b.name").attr("uid");$el.find("b.name").remove();if(uid){$el.find(".frm .user-list i[uid="+uid+"]").removeClass("on")}}$name.clone().prepend(document.createTextNode($item.find("b").text())).attr("uid",$item.attr("uid")).attr("username",$item.attr("username")).attr("fullname",$item.attr("fullname")).attr("image_url",$item.attr("image_url")).insertBefore($add);$add.text(txt_add[1]).hide();$el.find(".email-frm .text").attr("placeholder",txt_add[1]);setTimeout(function(){$inp.val("");$el.click()},10);$el.find(".frm > .send.after").show();$el.removeClass("hover");$(this).addClass("on")}).delegate("em.show_someone .user-list i.user:not(.load-more)","mousemove",function(event){var $el=$(this).closest(".show_someone");var $list=$el.find(".user-list");var $item=$(this);$list.find("i.selected").removeClass("selected");$(this).addClass("selected");$el.removeClass("hover");if(!$item.next().length&&!$el.find(".send.after").is(":visible")){$el.addClass("hover")}}).delegate("em.show_someone .user-list i.load-more","mousedown",function(){var $this=$(this);var $el=$(this).closest(".show_someone");var $inp=$el.find("input:text");$this.addClass("loading");request_username($(this).closest(".show_someone"),$.trim($inp.val()),$this.data("cursor"),function(){$this.removeClass("loading")});return false}).delegate("em.show_someone .success","click",function(event){$(this).closest(".buttons").find(".menu-container").removeClass("opened").find(".show_someone").hide().closest("li").removeClass("active");if($("html").hasClass("fixed")===true){var sc=$("#container-wrapper > .container").position().top;$("html").removeClass("fixed");$(window).scrollTop(-sc);$("#container-wrapper").find(".container").css("top","0px").end().css("padding-right","0");$("#header-new").css("padding-right","0px")}}).delegate("em.show_someone .btn-send","click",function(e){e.preventDefault();e.stopPropagation();var $this=$(this);var $el=$(this).closest(".show_someone");var $this=$(this),params,emails=[],users=[],endpoint;$this.disable();params={type:"nt",url:$el.attr("turl"),name:$el.attr("tname"),oid:$el.attr("tid"),ooid:$el.attr("uid"),message:$.trim($el.find(".frm textarea:eq(0)").val())};endpoint="/share-with-someone.json";$el.find(".email-frm b.name").each(function(){var $b=$(this);if($b.attr("email")){emails.push($b.attr("email"))}else{users.push($b.attr("uid"))}});if(!emails.length&&!users.length){$this.disable(false);return false}params.emails=emails.join(",");params.users=users.join(",");var count=emails.length+users.length;if(params.users){endpoint="/messages/send-message.json";params={user_id:users[0],things:params.oid,message:params.message}}$.ajax({type:"post",url:endpoint,data:params,dataType:"json",success:function(json){if(!json)return;if(json.status_code){var msg="";if(count==1){msg="This has been shown to "+$el.find(".email-frm b.name").text().replace("Delete","")+"."}else{msg="This has been shown to "+count+" friends."}$el.find(".success").html('<em class="circle"></em><b>Success!</b> '+msg).show().end().find(".email-frm, .frm").hide();if(users.length){var tmp_recent=[];$(users).each(function(){var uid=this+"";var $user=$el.find(".email-frm b.name[uid="+uid+"]");tmp_recent.push({id:uid,fullname:$user.attr("fullname"),username:$user.attr("username"),image_url:$user.attr("image_url")})});$(recent_shownto_or_following).each(function(){if(users.indexOf(this.id+"")==-1){tmp_recent.push(this)}});recent_shownto_or_following=tmp_recent}setTimeout(function(){$el.hide().closest("li").removeClass("active")},3e3)}else{alertify.alert(json.message)}},complete:function(){$this.disable(false)}});return false});function show_placeholder($el){$el.find(".frm > .user-list > i.user, .frm > .user-list > i.load-more").remove();$el.find(".frm > .user-list > i.result").hide();if(recent_shownto_or_following.length>0){$el.find(".frm > .user-list > i.empty").hide();add_items($el.find(".frm > .user-list"),recent_shownto_or_following)}else{$el.find(".frm > .user-list > i.empty").show()}}function request_username($el,val,cursor,oncomplete){var $inp=$el.find(".email-frm input:text"),$list=$el.find(".user-list"),$empty=$el.find("i.empty"),$result=$el.find("i.result");try{if(xhr&&xhr.abort)xhr.abort()}catch(e){}cursor=cursor||1;$result.hide();$empty.hide();var $more=$list.find(">i.load-more");if(!$more.length)$more=$('<i class="load-more"><span>'+gettext("Load more...")+"</span></i>");$more.appendTo($list).addClass("loading");$list.show();xhr=$.ajax({type:"get",url:"/search-users.json",data:{term:val,cursor:cursor,check_messages_permission:true,filter_messages_permission:true},dataType:"json",success:function(json){if(val!=$.trim($inp.val()))return;var list=[],exists={},i,c;$el.find(">b.name[uid]").each(function(){exists[this.getAttribute("uid")]=true});if(json&&json.list&&json.list.length){for(i=0,c=json.list.length;i<c;i++){if(!exists[json.list[i].id])list.push(json.list[i])}}if(list.length){if(json.next)list.next=json.next;add_items($list,list);$list.find(">i.user:first").addClass("selected");$result.hide();if(!cursor)$list.scrollTop(0)}else if(cursor==1){$result.show();$list.find(">i.load-more").remove()}},complete:oncomplete||$.noop})}function add_items($list,list){var $more=$list.find(">i.load-more");for(var i=0,c=list.length;i<c;i++){var $user=$item.clone().attr("uid",list[i].id).attr("username",list[i].username).attr("fullname",list[i].fullname).attr("image_url",list[i].image_url).find("img").attr("src",list[i].image_url).end().find("b").text(list[i].name||list[i].fullname||list[i].username).end().find("small").text("@"+list[i].username).end().appendTo($list);if($list.closest(".show_someone").find("b.name[uid='"+list[i].id+"']").length){$user.addClass("on")}}if(list.next){if(!$more.length)$more=$('<i class="load-more"><span>'+gettext("Load more...")+"</span></i>");$more.data("cursor",list.next).removeClass("loading").appendTo($list)}else{$more.remove()}}});jQuery(function($){$("#content").delegate(".show_cart, .menu-container:not(.on-home)","click",function(){var top=$(window).scrollTop();$(this).find("em.sale-item-input, small.menu-content, em.show_share, em.show_someone").removeClass("bot").filter(":visible").each(function(){var $el=$(this);if($el.offset().top<top+85)$el.addClass("bot")})})});jQuery(function($){var $clone=$("#clone-list"),dlg_clone=$.dialog("clone-list"),btn;$("#content,#sidebar,#summary").delegate(".btn-clone-list","click",function(event){if(event)event.preventDefault();btn=this;dlg_clone.open()});$clone.on("open",function(event){var $btn=$(btn);$clone.data({loid:$btn.attr("loid"),lid:$btn.attr("lid")});$("#name-clone-list").val("").focus()}).on("click","button.btn-clone",function(event){var params,list_name,$btn=$(this);event.preventDefault();list_name=$.trim($("#name-clone-list").val());if(!list_name)return alertify.alert(gettext("Please input name of list"));if($btn.hasClass("loading"))return;$btn.addClass("loading").text(gettext("Cloning..."));params={loid:$clone.data("loid"),lid:$clone.data("lid"),lname:list_name};function request(){$.ajax({type:"post",url:"/clone_list.xml",data:params,dataType:"xml",success:function(xml){var $xml=$(xml),$st=$xml.find("status_code"),error,msg;if(!$st.length)return;if($st.text()==1){alertify.alert(gettext("You have successfully cloned this list."));dlg_clone.close()}else if($st.text()==0){error=$xml.find("error").text();msg=$xml.find("message").text();if(error!="list_exist"){alertify.alert(msg)}else if(confirm(msg)){params["merge"]="true";request()}}},complete:function(){$btn.removeClass("loading").text(gettext("Clone List"))},error:function(){alert(gettext("Oops! Something went wrong."))}})}request()}).on("keypress","#name-clone-list",function(event){if(event.keyCode==13){$("button.btn-clone").click();return false}})});jQuery(function($){var $win=$(window),$body=$("body"),$stream=$(".stream"),$slidebox=$("#slideshow-box"),hh=$("header").eq(0).height(),$focused;if(!$stream.length)return;$stream.delegate("a[rel]",{setFocus:function(){var $this=$focused=$(this),ot=$this.offset().top,new_st;new_st=ot-hh-20;$body.stop().animate({scrollTop:new_st},function(){$this.get(0).focus();$focused=$this});$("a[rel].focus").removeClass("focus");$this.addClass("focus")},blur:function(){$(this).removeClass("focus");$focused=null}});$.hotkey({J:function(e){var s=state();if(s&SKIP)return;if(s&GOT_FOCUS){var $fp=$focused.parent(),$el;($el=$fp.prev(".figure-product")).length||($el=$fp.closest(".figure-row").prev(".figure-row")).length||($el=$fp.closest("li").prev("li")).length;$el.find("a[rel]:last").trigger("setFocus")}else{var $rows=$stream.find(".figure-row"),st=$win.scrollTop();$rows.each(function(i,v,a){var $this=$(this);if($this.offset().top-hh-st>20){if(i>0){$rows.eq(i-1).find("a[rel]:first").trigger("setFocus")}else{$this.find("a[rel]:first").trigger("setFocus")}return false}})}},K:function(e){var s=state();if(s&SKIP)return;if(s&GOT_FOCUS){var $fp=$focused.parent(),$el;($el=$fp.next(".figure-product")).length||($el=$fp.closest(".figure-row").next(".figure-row")).length||($el=$fp.closest("li").next("li")).length;$el.find("a[rel]:first").trigger("setFocus")}else{var st=$win.scrollTop();$stream.find(".figure-row").each(function(){var $this=$(this);if($this.offset().top-hh-st>20){$this.find("a[rel]:first").trigger("setFocus");return false}})}},F:function(e){if(state()&GOT_FOCUS){$focused.nextAll(".button.fancy, .button.fancyd").click()}},A:function(e){if(state()&GOT_FOCUS){$focused.nextAll(".button.fancy, .button.fancyd").attr("show_add_to_list","true").click()}},H:function(e){if(state()&GOT_FOCUS)$focused.find("button.btn-share").click()},ENTER:function(e){if(state()&GOT_FOCUS)$focused.click()}});var SKIP=1,GOT_FOCUS=2;function state(){if($slidebox.is(":visible"))return SKIP;if($focused&&$focused.is(".figure-product > a[rel].focus"))return GOT_FOCUS;$focused=$(":focus");if($focused.is("textarea,input:text,input:password"))return SKIP;return 0}});window._mt_ready_cart=function(){if(typeof MyThings!="undefined"&&window.MyThingsProductID){MyThings.Track({EventType:MyThings.Event.Visit,Action:"1013",ProductID:window.MyThingsProductID});MyThingsProductID=null}};var mtHost=("https:"==document.location.protocol?"https":"http")+"://rainbow-us.mythings.com";var mtAdvertiserToken="2236-100-us";jQuery(function($){if(navigator.platform.indexOf("Win")!=-1){$("body").addClass("winOS")}});jQuery(function($){var $openedPopup=null;$(document).on("click","a.selectBox.checkboxes_",function(event){event.preventDefault();var $this=$(this),$popup=$($this.attr("href")),defaultText=$this.text();$popup.addClass("selectbox_popup_").toggle();if(!$popup.data("event-attached")){$popup.on("click",'input[type="checkbox"]',function(event){var checked=[];$(this).closest(".selectbox_popup_").find('input[type="checkbox"]:checked').each(function(){checked.push($popup.find('label[for="'+this.id+'"]').text())});$this.find(".selectBox-label").text(checked.length?checked.join(", "):defaultText)});$popup.data("event-attached",true)}if($openedPopup&&$openedPopup.length){$openedPopup.hide();$openedPopup=null}if($popup.is(":visible")){$openedPopup=$popup}}).mousedown(function(event){var $target=$(event.target);if($openedPopup&&$openedPopup.length&&$target.closest(".selectBox.checkboxes_, .selectbox_popup_").length===0){$openedPopup.hide();$openedPopup=null}})});$(document).ready(function(){if(navigator.userAgent.indexOf("iPad")!=-1){$("html").addClass("ipad")}if(window.can_show_signin_overlay==true){$.dialog("popup.sign.signup").open().close=function(){}}if(/Safari/.test(navigator.userAgent)){$("body").addClass("chrome")}$("#cart_popup input").click(function(){$(this).select()});$(".share-via li").each(function(){$(this).mouseover(function(){$(this).find("em").css("left",28*$(this).index()+28+"px").css("margin-left",-($(this).find("em").width()/2)-8+"px")})});$(".share-with-someone .to input").focus(function(){$(this).parents(".email-frm").addClass("focus")});$(".share-with-someone .to input").blur(function(){$(this).parents(".email-frm").removeClass("focus")});$("#fancy-share .link").click(function(){$("#fancy-share .link input").stop()});$(".group-gifts .btn-edit").each(function(){var tLeft=-($(this).find(".tooltip small").width()+14)/2;$(this).find(".tooltip small").css("margin-left",tLeft+"px")})});window.numberFormat=function(num){var regex=/(\d)(\d{3})([,\.]|$)/,parts;num+="";if(window.numberType===2){num=num.replace(/,/g,".").replace(/ /g,"")}parts=num.replace(/,/g,"").split(".");parts[0]=parts[0].replace(/\d(?=(\d{3})+$)/g,"$&,");parts[1]=parts[1]?"."+parts[1]:"";return parts[0]+parts[1]};/* == jquery mousewheel plugin == Version: 3.1.11, License: MIT License (MIT) */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(a){function b(b){var g=b||window.event,h=i.call(arguments,1),j=0,l=0,m=0,n=0,o=0,p=0;if(b=a.event.fix(g),b.type="mousewheel","detail"in g&&(m=-1*g.detail),"wheelDelta"in g&&(m=g.wheelDelta),"wheelDeltaY"in g&&(m=g.wheelDeltaY),"wheelDeltaX"in g&&(l=-1*g.wheelDeltaX),"axis"in g&&g.axis===g.HORIZONTAL_AXIS&&(l=-1*m,m=0),j=0===m?l:m,"deltaY"in g&&(m=-1*g.deltaY,j=m),"deltaX"in g&&(l=g.deltaX,0===m&&(j=-1*l)),0!==m||0!==l){if(1===g.deltaMode){var q=a.data(this,"mousewheel-line-height");j*=q,m*=q,l*=q}else if(2===g.deltaMode){var r=a.data(this,"mousewheel-page-height");j*=r,m*=r,l*=r}if(n=Math.max(Math.abs(m),Math.abs(l)),(!f||f>n)&&(f=n,d(g,n)&&(f/=40)),d(g,n)&&(j/=40,l/=40,m/=40),j=Math[j>=1?"floor":"ceil"](j/f),l=Math[l>=1?"floor":"ceil"](l/f),m=Math[m>=1?"floor":"ceil"](m/f),k.settings.normalizeOffset&&this.getBoundingClientRect){var s=this.getBoundingClientRect();o=b.clientX-s.left,p=b.clientY-s.top}return b.deltaX=l,b.deltaY=m,b.deltaFactor=f,b.offsetX=o,b.offsetY=p,b.deltaMode=0,h.unshift(b,j,l,m),e&&clearTimeout(e),e=setTimeout(c,200),(a.event.dispatch||a.event.handle).apply(this,h)}}function c(){f=null}function d(a,b){return k.settings.adjustOldDeltas&&"mousewheel"===a.type&&b%120===0}var e,f,g=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],h="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],i=Array.prototype.slice;if(a.event.fixHooks)for(var j=g.length;j;)a.event.fixHooks[g[--j]]=a.event.mouseHooks;var k=a.event.special.mousewheel={version:"3.1.11",setup:function(){if(this.addEventListener)for(var c=h.length;c;)this.addEventListener(h[--c],b,!1);else this.onmousewheel=b;a.data(this,"mousewheel-line-height",k.getLineHeight(this)),a.data(this,"mousewheel-page-height",k.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var c=h.length;c;)this.removeEventListener(h[--c],b,!1);else this.onmousewheel=null;a.removeData(this,"mousewheel-line-height"),a.removeData(this,"mousewheel-page-height")},getLineHeight:function(b){var c=a(b)["offsetParent"in a.fn?"offsetParent":"parent"]();return c.length||(c=a("body")),parseInt(c.css("fontSize"),10)},getPageHeight:function(b){return a(b).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})});/* == malihu jquery custom scrollbar plugin == Version: 3.0.2, License: MIT License (MIT) */
(function(h,l,m,d){var e="mCustomScrollbar",a="mCS",k=".mCustomScrollbar",f={setWidth:false,setHeight:false,setTop:0,setLeft:0,axis:"y",scrollbarPosition:"inside",scrollInertia:950,autoDraggerLength:true,autoHideScrollbar:false,autoExpandScrollbar:false,alwaysShowScrollbar:0,snapAmount:null,snapOffset:0,mouseWheel:{enable:true,scrollAmount:"auto",axis:"y",preventDefault:false,deltaFactor:"auto",normalizeDelta:false,invert:false,disableOver:["select","option","keygen","datalist","textarea"]},scrollButtons:{enable:false,scrollType:"stepless",scrollAmount:"auto"},keyboard:{enable:true,scrollType:"stepless",scrollAmount:"auto"},contentTouchScroll:25,advanced:{autoExpandHorizontalScroll:false,autoScrollOnFocus:"input,textarea,select,button,datalist,keygen,a[tabindex],area,object,[contenteditable='true']",updateOnContentResize:true,updateOnImageLoad:true,updateOnSelectorChange:false},theme:"light",callbacks:{onScrollStart:false,onScroll:false,onTotalScroll:false,onTotalScrollBack:false,whileScrolling:false,onTotalScrollOffset:0,onTotalScrollBackOffset:0,alwaysTriggerOffsets:true},live:false,liveSelector:null},j=0,o={},c=function(p){if(o[p]){clearTimeout(o[p]);g._delete.call(null,o[p])}},i=l.attachEvent&&!l.addEventListener?1:0,n=false,b={init:function(q){var q=h.extend(true,{},f,q),p=g._selector.call(this);if(q.live){var s=q.liveSelector||this.selector||k,r=h(s);if(q.live==="off"){c(s);return}o[s]=setTimeout(function(){r.mCustomScrollbar(q);if(q.live==="once"&&r.length){c(s)}},500)}else{c(s)}q.setWidth=q.set_width?q.set_width:q.setWidth;q.setHeight=q.set_height?q.set_height:q.setHeight;q.axis=q.horizontalScroll?"x":g._findAxis.call(null,q.axis);q.scrollInertia=q.scrollInertia<17?17:q.scrollInertia;if(typeof q.mouseWheel!=="object"&&q.mouseWheel==true){q.mouseWheel={enable:true,scrollAmount:"auto",axis:"y",preventDefault:false,deltaFactor:"auto",normalizeDelta:false,invert:false}}q.mouseWheel.scrollAmount=!q.mouseWheelPixels?q.mouseWheel.scrollAmount:q.mouseWheelPixels;q.mouseWheel.normalizeDelta=!q.advanced.normalizeMouseWheelDelta?q.mouseWheel.normalizeDelta:q.advanced.normalizeMouseWheelDelta;q.scrollButtons.scrollType=g._findScrollButtonsType.call(null,q.scrollButtons.scrollType);g._theme.call(null,q);return h(p).each(function(){var u=h(this);if(!u.data(a)){u.data(a,{idx:++j,opt:q,scrollRatio:{y:null,x:null},overflowed:null,bindEvents:false,tweenRunning:false,sequential:{},langDir:u.css("direction"),cbOffsets:null,trigger:null});var w=u.data(a).opt,v=u.data("mcs-axis"),t=u.data("mcs-scrollbar-position"),x=u.data("mcs-theme");if(v){w.axis=v}if(t){w.scrollbarPosition=t}if(x){w.theme=x;g._theme.call(null,w)}g._pluginMarkup.call(this);b.update.call(null,u)}})},update:function(q){var p=q||g._selector.call(this);return h(p).each(function(){var t=h(this);if(t.data(a)){var v=t.data(a),u=v.opt,r=h("#mCSB_"+v.idx+"_container"),s=[h("#mCSB_"+v.idx+"_dragger_vertical"),h("#mCSB_"+v.idx+"_dragger_horizontal")];if(!r.length){return}if(v.tweenRunning){g._stop.call(null,t)}if(t.hasClass("mCS_disabled")){t.removeClass("mCS_disabled")}if(t.hasClass("mCS_destroyed")){t.removeClass("mCS_destroyed")}g._maxHeight.call(this);g._expandContentHorizontally.call(this);if(u.axis!=="y"&&!u.advanced.autoExpandHorizontalScroll){r.css("width",g._contentWidth(r.children()))}v.overflowed=g._overflowed.call(this);g._scrollbarVisibility.call(this);if(u.autoDraggerLength){g._setDraggerLength.call(this)}g._scrollRatio.call(this);g._bindEvents.call(this);var w=[Math.abs(r[0].offsetTop),Math.abs(r[0].offsetLeft)];if(u.axis!=="x"){if(!v.overflowed[0]){g._resetContentPosition.call(this);if(u.axis==="y"){g._unbindEvents.call(this)}else{if(u.axis==="yx"&&v.overflowed[1]){g._scrollTo.call(this,t,w[1].toString(),{dir:"x",dur:0,overwrite:"none"})}}}else{if(s[0].height()>s[0].parent().height()){g._resetContentPosition.call(this)}else{g._scrollTo.call(this,t,w[0].toString(),{dir:"y",dur:0,overwrite:"none"})}}}if(u.axis!=="y"){if(!v.overflowed[1]){g._resetContentPosition.call(this);if(u.axis==="x"){g._unbindEvents.call(this)}else{if(u.axis==="yx"&&v.overflowed[0]){g._scrollTo.call(this,t,w[0].toString(),{dir:"y",dur:0,overwrite:"none"})}}}else{if(s[1].width()>s[1].parent().width()){g._resetContentPosition.call(this)}else{g._scrollTo.call(this,t,w[1].toString(),{dir:"x",dur:0,overwrite:"none"})}}}g._autoUpdate.call(this)}})},scrollTo:function(r,q){if(typeof r=="undefined"||r==null){return}var p=g._selector.call(this);return h(p).each(function(){var u=h(this);if(u.data(a)){var x=u.data(a),w=x.opt,v={trigger:"external",scrollInertia:w.scrollInertia,scrollEasing:"mcsEaseInOut",moveDragger:false,callbacks:true,onStart:true,onUpdate:true,onComplete:true},s=h.extend(true,{},v,q),y=g._arr.call(this,r),t=s.scrollInertia<17?17:s.scrollInertia;y[0]=g._to.call(this,y[0],"y");y[1]=g._to.call(this,y[1],"x");if(s.moveDragger){y[0]*=x.scrollRatio.y;y[1]*=x.scrollRatio.x}s.dur=t;setTimeout(function(){if(y[0]!==null&&typeof y[0]!=="undefined"&&w.axis!=="x"&&x.overflowed[0]){s.dir="y";s.overwrite="all";g._scrollTo.call(this,u,y[0].toString(),s)}if(y[1]!==null&&typeof y[1]!=="undefined"&&w.axis!=="y"&&x.overflowed[1]){s.dir="x";s.overwrite="none";g._scrollTo.call(this,u,y[1].toString(),s)}},60)}})},stop:function(){var p=g._selector.call(this);return h(p).each(function(){var q=h(this);if(q.data(a)){g._stop.call(null,q)}})},disable:function(q){var p=g._selector.call(this);return h(p).each(function(){var r=h(this);if(r.data(a)){var t=r.data(a),s=t.opt;g._autoUpdate.call(this,"remove");g._unbindEvents.call(this);if(q){g._resetContentPosition.call(this)}g._scrollbarVisibility.call(this,true);r.addClass("mCS_disabled")}})},destroy:function(){var p=g._selector.call(this);return h(p).each(function(){var s=h(this);if(s.data(a)){var u=s.data(a),t=u.opt,q=h("#mCSB_"+u.idx),r=h("#mCSB_"+u.idx+"_container"),v=h(".mCSB_"+u.idx+"_scrollbar");if(t.live){c(p)}g._autoUpdate.call(this,"remove");g._unbindEvents.call(this);g._resetContentPosition.call(this);s.removeData(a);g._delete.call(null,this.mcs);v.remove();q.replaceWith(r.contents());s.removeClass(e+" _"+a+"_"+u.idx+" mCS-autoHide mCS-dir-rtl mCS_no_scrollbar mCS_disabled").addClass("mCS_destroyed")}})}},g={_selector:function(){return typeof h(this)!=="object"||h(this).length<1?k:this},_theme:function(s){var r=["rounded","rounded-dark","rounded-dots","rounded-dots-dark"],q=["rounded-dots","rounded-dots-dark","3d","3d-dark","3d-thick","3d-thick-dark","inset","inset-dark","inset-2","inset-2-dark","inset-3","inset-3-dark"],p=["minimal","minimal-dark"],u=["minimal","minimal-dark"],t=["minimal","minimal-dark"];s.autoDraggerLength=h.inArray(s.theme,r)>-1?false:s.autoDraggerLength;s.autoExpandScrollbar=h.inArray(s.theme,q)>-1?false:s.autoExpandScrollbar;s.scrollButtons.enable=h.inArray(s.theme,p)>-1?false:s.scrollButtons.enable;s.autoHideScrollbar=h.inArray(s.theme,u)>-1?true:s.autoHideScrollbar;s.scrollbarPosition=h.inArray(s.theme,t)>-1?"outside":s.scrollbarPosition},_findAxis:function(p){return p==="yx"||p==="xy"||p==="auto"?"yx":p==="x"||p==="horizontal"?"x":"y"},_findScrollButtonsType:function(p){return p==="stepped"||p==="pixels"||p==="step"||p==="click"?"stepped":"stepless"},_pluginMarkup:function(){var y=h(this),x=y.data(a),r=x.opt,t=r.autoExpandScrollbar?" mCSB_scrollTools_onDrag_expand":"",B=["<div id='mCSB_"+x.idx+"_scrollbar_vertical' class='mCSB_scrollTools mCSB_"+x.idx+"_scrollbar mCS-"+r.theme+" mCSB_scrollTools_vertical"+t+"'><div class='mCSB_draggerContainer'><div id='mCSB_"+x.idx+"_dragger_vertical' class='mCSB_dragger' style='position:absolute;' oncontextmenu='return false;'><div class='mCSB_dragger_bar' /></div><div class='mCSB_draggerRail' /></div></div>","<div id='mCSB_"+x.idx+"_scrollbar_horizontal' class='mCSB_scrollTools mCSB_"+x.idx+"_scrollbar mCS-"+r.theme+" mCSB_scrollTools_horizontal"+t+"'><div class='mCSB_draggerContainer'><div id='mCSB_"+x.idx+"_dragger_horizontal' class='mCSB_dragger' style='position:absolute;' oncontextmenu='return false;'><div class='mCSB_dragger_bar' /></div><div class='mCSB_draggerRail' /></div></div>"],u=r.axis==="yx"?"mCSB_vertical_horizontal":r.axis==="x"?"mCSB_horizontal":"mCSB_vertical",w=r.axis==="yx"?B[0]+B[1]:r.axis==="x"?B[1]:B[0],v=r.axis==="yx"?"<div id='mCSB_"+x.idx+"_container_wrapper' class='mCSB_container_wrapper' />":"",s=r.autoHideScrollbar?" mCS-autoHide":"",p=r.axis!=="x"&&x.langDir==="rtl"?" mCS-dir-rtl":"";if(r.setWidth){y.css("width",r.setWidth)}if(r.setHeight){y.css("height",r.setHeight)}r.setLeft=r.axis!=="y"&&x.langDir==="rtl"?"989999px":r.setLeft;y.addClass(e+" _"+a+"_"+x.idx+s+p).wrapInner("<div id='mCSB_"+x.idx+"' class='mCustomScrollBox mCS-"+r.theme+" "+u+"'><div id='mCSB_"+x.idx+"_container' class='mCSB_container' style='position:relative; top:"+r.setTop+"; left:"+r.setLeft+";' dir="+x.langDir+" /></div>");var q=h("#mCSB_"+x.idx),z=h("#mCSB_"+x.idx+"_container");if(r.axis!=="y"&&!r.advanced.autoExpandHorizontalScroll){z.css("width",g._contentWidth(z.children()))}if(r.scrollbarPosition==="outside"){if(y.css("position")==="static"){y.css("position","relative")}y.css("overflow","visible");q.addClass("mCSB_outside").after(w)}else{q.addClass("mCSB_inside").append(w);z.wrap(v)}g._scrollButtons.call(this);var A=[h("#mCSB_"+x.idx+"_dragger_vertical"),h("#mCSB_"+x.idx+"_dragger_horizontal")];A[0].css("min-height",A[0].height());A[1].css("min-width",A[1].width())},_contentWidth:function(p){return Math.max.apply(Math,p.map(function(){return h(this).outerWidth(true)}).get())},_expandContentHorizontally:function(){var q=h(this),s=q.data(a),r=s.opt,p=h("#mCSB_"+s.idx+"_container");if(r.advanced.autoExpandHorizontalScroll&&r.axis!=="y"){p.css({position:"absolute",width:"auto"}).wrap("<div class='mCSB_h_wrapper' style='position:relative; left:0; width:999999px;' />").css({width:Math.ceil(p[0].getBoundingClientRect().right+.4)-Math.floor(p[0].getBoundingClientRect().left),position:"relative"}).unwrap()}},_scrollButtons:function(){var s=h(this),u=s.data(a),t=u.opt,q=h(".mCSB_"+u.idx+"_scrollbar:first"),r=["<a href='#' class='mCSB_buttonUp' oncontextmenu='return false;' />","<a href='#' class='mCSB_buttonDown' oncontextmenu='return false;' />","<a href='#' class='mCSB_buttonLeft' oncontextmenu='return false;' />","<a href='#' class='mCSB_buttonRight' oncontextmenu='return false;' />"],p=[t.axis==="x"?r[2]:r[0],t.axis==="x"?r[3]:r[1],r[2],r[3]];if(t.scrollButtons.enable){q.prepend(p[0]).append(p[1]).next(".mCSB_scrollTools").prepend(p[2]).append(p[3])}},_maxHeight:function(){var t=h(this),w=t.data(a),v=w.opt,r=h("#mCSB_"+w.idx),q=t.css("max-height"),s=q.indexOf("%")!==-1,p=t.css("box-sizing");if(q!=="none"){var u=s?t.parent().height()*parseInt(q)/100:parseInt(q);if(p==="border-box"){u-=t.innerHeight()-t.height()+(t.outerHeight()-t.innerHeight())}r.css("max-height",Math.round(u))}},_setDraggerLength:function(){var u=h(this),s=u.data(a),p=h("#mCSB_"+s.idx),v=h("#mCSB_"+s.idx+"_container"),y=[h("#mCSB_"+s.idx+"_dragger_vertical"),h("#mCSB_"+s.idx+"_dragger_horizontal")],t=[p.height()/v.outerHeight(false),p.width()/v.outerWidth(false)],q=[parseInt(y[0].css("min-height")),Math.round(t[0]*y[0].parent().height()),parseInt(y[1].css("min-width")),Math.round(t[1]*y[1].parent().width())],r=i&&q[1]<q[0]?q[0]:q[1],x=i&&q[3]<q[2]?q[2]:q[3];y[0].css({height:r,"max-height":y[0].parent().height()-10}).find(".mCSB_dragger_bar").css({"line-height":q[0]+"px"});y[1].css({width:x,"max-width":y[1].parent().width()-10})},_scrollRatio:function(){var t=h(this),v=t.data(a),q=h("#mCSB_"+v.idx),r=h("#mCSB_"+v.idx+"_container"),s=[h("#mCSB_"+v.idx+"_dragger_vertical"),h("#mCSB_"+v.idx+"_dragger_horizontal")],u=[r.outerHeight(false)-q.height(),r.outerWidth(false)-q.width()],p=[u[0]/(s[0].parent().height()-s[0].height()),u[1]/(s[1].parent().width()-s[1].width())];v.scrollRatio={y:p[0],x:p[1]}},_onDragClasses:function(r,t,q){var s=q?"mCSB_dragger_onDrag_expanded":"",p=["mCSB_dragger_onDrag","mCSB_scrollTools_onDrag"],u=r.closest(".mCSB_scrollTools");if(t==="active"){r.toggleClass(p[0]+" "+s);u.toggleClass(p[1]);r[0]._draggable=r[0]._draggable?0:1}else{if(!r[0]._draggable){if(t==="hide"){r.removeClass(p[0]);u.removeClass(p[1])}else{r.addClass(p[0]);u.addClass(p[1])}}}},_overflowed:function(){var t=h(this),u=t.data(a),q=h("#mCSB_"+u.idx),s=h("#mCSB_"+u.idx+"_container"),r=u.overflowed==null?s.height():s.outerHeight(false),p=u.overflowed==null?s.width():s.outerWidth(false);return[r>q.height(),p>q.width()]},_resetContentPosition:function(){var t=h(this),v=t.data(a),u=v.opt,q=h("#mCSB_"+v.idx),r=h("#mCSB_"+v.idx+"_container"),s=[h("#mCSB_"+v.idx+"_dragger_vertical"),h("#mCSB_"+v.idx+"_dragger_horizontal")];g._stop(t);if(u.axis!=="x"&&!v.overflowed[0]||u.axis==="y"&&v.overflowed[0]){s[0].add(r).css("top",0)}if(u.axis!=="y"&&!v.overflowed[1]||u.axis==="x"&&v.overflowed[1]){var p=dx=0;if(v.langDir==="rtl"){p=q.width()-r.outerWidth(false);dx=Math.abs(p/v.scrollRatio.x)}r.css("left",p);s[1].css("left",dx)}},_bindEvents:function(){var r=h(this),t=r.data(a),s=t.opt;if(!t.bindEvents){g._draggable.call(this);if(s.contentTouchScroll){g._contentDraggable.call(this)}if(s.mouseWheel.enable){function q(){p=setTimeout(function(){if(!h.event.special.mousewheel){q()}else{clearTimeout(p);g._mousewheel.call(r[0])}},1e3)}var p;q()}g._draggerRail.call(this);g._wrapperScroll.call(this);if(s.advanced.autoScrollOnFocus){g._focus.call(this)}if(s.scrollButtons.enable){g._buttons.call(this)}if(s.keyboard.enable){g._keyboard.call(this)}t.bindEvents=true}},_unbindEvents:function(){var s=h(this),t=s.data(a),p=a+"_"+t.idx,u=".mCSB_"+t.idx+"_scrollbar",r=h("#mCSB_"+t.idx+",#mCSB_"+t.idx+"_container,#mCSB_"+t.idx+"_container_wrapper,"+u+" .mCSB_draggerContainer,#mCSB_"+t.idx+"_dragger_vertical,#mCSB_"+t.idx+"_dragger_horizontal,"+u+">a"),q=h("#mCSB_"+t.idx+"_container");if(t.bindEvents){h(m).unbind("."+p);r.each(function(){h(this).unbind("."+p)});clearTimeout(s[0]._focusTimeout);g._delete.call(null,s[0]._focusTimeout);clearTimeout(t.sequential.step);g._delete.call(null,t.sequential.step);clearTimeout(q[0].onCompleteTimeout);g._delete.call(null,q[0].onCompleteTimeout);t.bindEvents=false}},_scrollbarVisibility:function(q){var t=h(this),v=t.data(a),u=v.opt,p=h("#mCSB_"+v.idx+"_container_wrapper"),r=p.length?p:h("#mCSB_"+v.idx+"_container"),w=[h("#mCSB_"+v.idx+"_scrollbar_vertical"),h("#mCSB_"+v.idx+"_scrollbar_horizontal")],s=[w[0].find(".mCSB_dragger"),w[1].find(".mCSB_dragger")];if(u.axis!=="x"){if(v.overflowed[0]&&!q){w[0].add(s[0]).add(w[0].children("a")).css("display","block");r.removeClass("mCS_no_scrollbar_y mCS_y_hidden")}else{if(u.alwaysShowScrollbar){if(u.alwaysShowScrollbar!==2){s[0].add(w[0].children("a")).css("display","none")}r.removeClass("mCS_y_hidden")}else{w[0].css("display","none");r.addClass("mCS_y_hidden")}r.addClass("mCS_no_scrollbar_y")}}if(u.axis!=="y"){if(v.overflowed[1]&&!q){w[1].add(s[1]).add(w[1].children("a")).css("display","block");r.removeClass("mCS_no_scrollbar_x mCS_x_hidden")}else{if(u.alwaysShowScrollbar){if(u.alwaysShowScrollbar!==2){s[1].add(w[1].children("a")).css("display","none")}r.removeClass("mCS_x_hidden")}else{w[1].css("display","none");r.addClass("mCS_x_hidden")}r.addClass("mCS_no_scrollbar_x")}}if(!v.overflowed[0]&&!v.overflowed[1]){t.addClass("mCS_no_scrollbar")}else{t.removeClass("mCS_no_scrollbar")}},_coordinates:function(q){var p=q.type;switch(p){case"pointerdown":case"MSPointerDown":case"pointermove":case"MSPointerMove":case"pointerup":case"MSPointerUp":return[q.originalEvent.pageY,q.originalEvent.pageX];break;case"touchstart":case"touchmove":case"touchend":var r=q.originalEvent.touches[0]||q.originalEvent.changedTouches[0];return[r.pageY,r.pageX];break;default:return[q.pageY,q.pageX]}},_draggable:function(){var u=h(this),s=u.data(a),p=s.opt,r=a+"_"+s.idx,t=["mCSB_"+s.idx+"_dragger_vertical","mCSB_"+s.idx+"_dragger_horizontal"],v=h("#mCSB_"+s.idx+"_container"),w=h("#"+t[0]+",#"+t[1]),A,y,z;w.bind("mousedown."+r+" touchstart."+r+" pointerdown."+r+" MSPointerDown."+r,function(E){E.stopImmediatePropagation();E.preventDefault();if(!g._mouseBtnLeft(E)){return}n=true;if(i){m.onselectstart=function(){return false}}x(false);g._stop(u);A=h(this);var F=A.offset(),G=g._coordinates(E)[0]-F.top,B=g._coordinates(E)[1]-F.left,D=A.height()+F.top,C=A.width()+F.left;if(G<D&&G>0&&B<C&&B>0){y=G;z=B}g._onDragClasses(A,"active",p.autoExpandScrollbar)}).bind("touchmove."+r,function(C){C.stopImmediatePropagation();C.preventDefault();var D=A.offset(),E=g._coordinates(C)[0]-D.top,B=g._coordinates(C)[1]-D.left;q(y,z,E,B)});h(m).bind("mousemove."+r+" pointermove."+r+" MSPointerMove."+r,function(C){if(A){var D=A.offset(),E=g._coordinates(C)[0]-D.top,B=g._coordinates(C)[1]-D.left;if(y===E){return}q(y,z,E,B)}}).add(w).bind("mouseup."+r+" touchend."+r+" pointerup."+r+" MSPointerUp."+r,function(B){if(A){g._onDragClasses(A,"active",p.autoExpandScrollbar);A=null}n=false;if(i){m.onselectstart=null}x(true)});function x(B){var C=v.find("iframe");if(!C.length){return}var D=!B?"none":"auto";C.css("pointer-events",D)}function q(D,E,G,B){v[0].idleTimer=p.scrollInertia<233?250:0;if(A.attr("id")===t[1]){var C="x",F=(A[0].offsetLeft-E+B)*s.scrollRatio.x}else{var C="y",F=(A[0].offsetTop-D+G)*s.scrollRatio.y}g._scrollTo(u,F.toString(),{dir:C,drag:true})}},_contentDraggable:function(){var y=h(this),K=y.data(a),I=K.opt,F=a+"_"+K.idx,v=h("#mCSB_"+K.idx),z=h("#mCSB_"+K.idx+"_container"),w=[h("#mCSB_"+K.idx+"_dragger_vertical"),h("#mCSB_"+K.idx+"_dragger_horizontal")],E,G,L,M,C=[],D=[],H,A,u,t,J,x,r=0,q,s=I.axis==="yx"?"none":"all";z.bind("touchstart."+F+" pointerdown."+F+" MSPointerDown."+F,function(N){if(!g._pointerTouch(N)||n){return}var O=z.offset();E=g._coordinates(N)[0]-O.top;G=g._coordinates(N)[1]-O.left}).bind("touchmove."+F+" pointermove."+F+" MSPointerMove."+F,function(Q){if(!g._pointerTouch(Q)||n){return}Q.stopImmediatePropagation();A=g._getTime();var P=v.offset(),S=g._coordinates(Q)[0]-P.top,U=g._coordinates(Q)[1]-P.left,R="mcsLinearOut";C.push(S);D.push(U);if(K.overflowed[0]){var O=w[0].parent().height()-w[0].height(),T=E-S>0&&S-E>-(O*K.scrollRatio.y)}if(K.overflowed[1]){var N=w[1].parent().width()-w[1].width(),V=G-U>0&&U-G>-(N*K.scrollRatio.x)}if(T||V){Q.preventDefault()}x=I.axis==="yx"?[E-S,G-U]:I.axis==="x"?[null,G-U]:[E-S,null];z[0].idleTimer=250;if(K.overflowed[0]){B(x[0],r,R,"y","all",true)}if(K.overflowed[1]){B(x[1],r,R,"x",s,true)}});v.bind("touchstart."+F+" pointerdown."+F+" MSPointerDown."+F,function(N){if(!g._pointerTouch(N)||n){return}N.stopImmediatePropagation();g._stop(y);H=g._getTime();var O=v.offset();L=g._coordinates(N)[0]-O.top;M=g._coordinates(N)[1]-O.left;C=[];D=[]}).bind("touchend."+F+" pointerup."+F+" MSPointerUp."+F,function(P){if(!g._pointerTouch(P)||n){return}P.stopImmediatePropagation();u=g._getTime();var N=v.offset(),T=g._coordinates(P)[0]-N.top,V=g._coordinates(P)[1]-N.left;if(u-A>30){return}J=1e3/(u-H);var Q="mcsEaseOut",R=J<2.5,W=R?[C[C.length-2],D[D.length-2]]:[0,0];t=R?[T-W[0],V-W[1]]:[T-L,V-M];var O=[Math.abs(t[0]),Math.abs(t[1])];J=R?[Math.abs(t[0]/4),Math.abs(t[1]/4)]:[J,J];var U=[Math.abs(z[0].offsetTop)-t[0]*p(O[0]/J[0],J[0]),Math.abs(z[0].offsetLeft)-t[1]*p(O[1]/J[1],J[1])];x=I.axis==="yx"?[U[0],U[1]]:I.axis==="x"?[null,U[1]]:[U[0],null];q=[O[0]*4+I.scrollInertia,O[1]*4+I.scrollInertia];var S=parseInt(I.contentTouchScroll)||0;x[0]=O[0]>S?x[0]:0;x[1]=O[1]>S?x[1]:0;if(K.overflowed[0]){B(x[0],q[0],Q,"y",s,false)}if(K.overflowed[1]){B(x[1],q[1],Q,"x",s,false)}});function p(P,N){var O=[N*1.5,N*2,N/1.5,N/2];if(P>90){return N>4?O[0]:O[3]}else{if(P>60){return N>3?O[3]:O[2]}else{if(P>30){return N>8?O[1]:N>6?O[0]:N>4?N:O[2]}else{return N>8?N:O[3]}}}}function B(P,R,S,O,N,Q){if(!P){return}g._scrollTo(y,P.toString(),{dur:R,scrollEasing:S,dir:O,overwrite:N,drag:Q})}},_mousewheel:function(){var s=h(this),u=s.data(a),t=u.opt,q=a+"_"+u.idx,p=h("#mCSB_"+u.idx),r=[h("#mCSB_"+u.idx+"_dragger_vertical"),h("#mCSB_"+u.idx+"_dragger_horizontal")];p.bind("mousewheel."+q,function(z,D){g._stop(s);if(g._disableMousewheel(s,z.target)){return}var B=t.mouseWheel.deltaFactor!=="auto"?parseInt(t.mouseWheel.deltaFactor):i&&z.deltaFactor<100?100:z.deltaFactor<40?40:z.deltaFactor||100;if(t.axis==="x"||t.mouseWheel.axis==="x"){var w="x",C=[Math.round(B*u.scrollRatio.x),parseInt(t.mouseWheel.scrollAmount)],y=t.mouseWheel.scrollAmount!=="auto"?C[1]:C[0]>=p.width()?p.width()*.9:C[0],E=Math.abs(h("#mCSB_"+u.idx+"_container")[0].offsetLeft),A=r[1][0].offsetLeft,x=r[1].parent().width()-r[1].width(),v=z.deltaX||z.deltaY||D}else{var w="y",C=[Math.round(B*u.scrollRatio.y),parseInt(t.mouseWheel.scrollAmount)],y=t.mouseWheel.scrollAmount!=="auto"?C[1]:C[0]>=p.height()?p.height()*.9:C[0],E=Math.abs(h("#mCSB_"+u.idx+"_container")[0].offsetTop),A=r[0][0].offsetTop,x=r[0].parent().height()-r[0].height(),v=z.deltaY||D}if(w==="y"&&!u.overflowed[0]||w==="x"&&!u.overflowed[1]){return}if(t.mouseWheel.invert){v=-v}if(t.mouseWheel.normalizeDelta){v=v<0?-1:1}if(v>0&&A!==0||v<0&&A!==x||t.mouseWheel.preventDefault){z.stopImmediatePropagation();z.preventDefault()}g._scrollTo(s,(E-v*y).toString(),{dir:w})})},_disableMousewheel:function(r,t){var p=t.nodeName.toLowerCase(),q=r.data(a).opt.mouseWheel.disableOver,s=["select","textarea"];return h.inArray(p,q)>-1&&!(h.inArray(p,s)>-1&&!h(t).is(":focus"))},_draggerRail:function(){var s=h(this),t=s.data(a),q=a+"_"+t.idx,r=h("#mCSB_"+t.idx+"_container"),u=r.parent(),p=h(".mCSB_"+t.idx+"_scrollbar .mCSB_draggerContainer");p.bind("touchstart."+q+" pointerdown."+q+" MSPointerDown."+q,function(v){n=true}).bind("touchend."+q+" pointerup."+q+" MSPointerUp."+q,function(v){n=false}).bind("click."+q,function(z){if(h(z.target).hasClass("mCSB_draggerContainer")||h(z.target).hasClass("mCSB_draggerRail")){g._stop(s);var w=h(this),y=w.find(".mCSB_dragger");if(w.parent(".mCSB_scrollTools_horizontal").length>0){if(!t.overflowed[1]){return}var v="x",x=z.pageX>y.offset().left?-1:1,A=Math.abs(r[0].offsetLeft)-x*(u.width()*.9)}else{if(!t.overflowed[0]){return}var v="y",x=z.pageY>y.offset().top?-1:1,A=Math.abs(r[0].offsetTop)-x*(u.height()*.9)}g._scrollTo(s,A.toString(),{dir:v,scrollEasing:"mcsEaseInOut"})}})},_focus:function(){var r=h(this),t=r.data(a),s=t.opt,p=a+"_"+t.idx,q=h("#mCSB_"+t.idx+"_container"),u=q.parent();q.bind("focusin."+p,function(x){var w=h(m.activeElement),y=q.find(".mCustomScrollBox").length,v=0;if(!w.is(s.advanced.autoScrollOnFocus)){return}g._stop(r);clearTimeout(r[0]._focusTimeout);r[0]._focusTimer=y?(v+17)*y:0;r[0]._focusTimeout=setTimeout(function(){var C=[w.offset().top-q.offset().top,w.offset().left-q.offset().left],B=[q[0].offsetTop,q[0].offsetLeft],z=[B[0]+C[0]>=0&&B[0]+C[0]<u.height()-w.outerHeight(false),B[1]+C[1]>=0&&B[0]+C[1]<u.width()-w.outerWidth(false)],A=s.axis==="yx"&&!z[0]&&!z[1]?"none":"all";if(s.axis!=="x"&&!z[0]){g._scrollTo(r,C[0].toString(),{dir:"y",scrollEasing:"mcsEaseInOut",overwrite:A,dur:v})}if(s.axis!=="y"&&!z[1]){g._scrollTo(r,C[1].toString(),{dir:"x",scrollEasing:"mcsEaseInOut",overwrite:A,dur:v})}},r[0]._focusTimer)})},_wrapperScroll:function(){var q=h(this),r=q.data(a),p=a+"_"+r.idx,s=h("#mCSB_"+r.idx+"_container").parent();s.bind("scroll."+p,function(t){s.scrollTop(0).scrollLeft(0)})},_buttons:function(){var u=h(this),w=u.data(a),v=w.opt,p=w.sequential,r=a+"_"+w.idx,t=h("#mCSB_"+w.idx+"_container"),s=".mCSB_"+w.idx+"_scrollbar",q=h(s+">a");q.bind("mousedown."+r+" touchstart."+r+" pointerdown."+r+" MSPointerDown."+r+" mouseup."+r+" touchend."+r+" pointerup."+r+" MSPointerUp."+r+" mouseout."+r+" pointerout."+r+" MSPointerOut."+r+" click."+r,function(z){z.preventDefault();if(!g._mouseBtnLeft(z)){return}var y=h(this).attr("class");p.type=v.scrollButtons.scrollType;switch(z.type){case"mousedown":case"touchstart":case"pointerdown":case"MSPointerDown":if(p.type==="stepped"){return}n=true;w.tweenRunning=false;x("on",y);break;case"mouseup":case"touchend":case"pointerup":case"MSPointerUp":case"mouseout":case"pointerout":case"MSPointerOut":if(p.type==="stepped"){return}n=false;if(p.dir){x("off",y)}break;case"click":if(p.type!=="stepped"||w.tweenRunning){return}x("on",y);break}function x(A,B){p.scrollAmount=v.snapAmount||v.scrollButtons.scrollAmount;g._sequentialScroll.call(this,u,A,B)}})},_keyboard:function(){var u=h(this),t=u.data(a),q=t.opt,x=t.sequential,s=a+"_"+t.idx,r=h("#mCSB_"+t.idx),w=h("#mCSB_"+t.idx+"_container"),p=w.parent(),v="input,textarea,select,datalist,keygen,[contenteditable='true']";r.attr("tabindex","0").bind("blur."+s+" keydown."+s+" keyup."+s,function(D){switch(D.type){case"blur":if(t.tweenRunning&&x.dir){y("off",null)}break;case"keydown":case"keyup":var A=D.keyCode?D.keyCode:D.which,B="on";if(q.axis!=="x"&&(A===38||A===40)||q.axis!=="y"&&(A===37||A===39)){if((A===38||A===40)&&!t.overflowed[0]||(A===37||A===39)&&!t.overflowed[1]){return}if(D.type==="keyup"){B="off"}if(!h(m.activeElement).is(v)){D.preventDefault();D.stopImmediatePropagation();y(B,A)}}else{if(A===33||A===34){if(t.overflowed[0]||t.overflowed[1]){D.preventDefault();D.stopImmediatePropagation()}if(D.type==="keyup"){g._stop(u);var C=A===34?-1:1;if(q.axis==="x"||q.axis==="yx"&&t.overflowed[1]&&!t.overflowed[0]){var z="x",E=Math.abs(w[0].offsetLeft)-C*(p.width()*.9)}else{var z="y",E=Math.abs(w[0].offsetTop)-C*(p.height()*.9)}g._scrollTo(u,E.toString(),{dir:z,scrollEasing:"mcsEaseInOut"})}}else{if(A===35||A===36){if(!h(m.activeElement).is(v)){if(t.overflowed[0]||t.overflowed[1]){D.preventDefault();D.stopImmediatePropagation()}if(D.type==="keyup"){if(q.axis==="x"||q.axis==="yx"&&t.overflowed[1]&&!t.overflowed[0]){var z="x",E=A===35?Math.abs(p.width()-w.outerWidth(false)):0}else{var z="y",E=A===35?Math.abs(p.height()-w.outerHeight(false)):0}g._scrollTo(u,E.toString(),{dir:z,scrollEasing:"mcsEaseInOut"})}}}}}break}function y(F,G){x.type=q.keyboard.scrollType;x.scrollAmount=q.snapAmount||q.keyboard.scrollAmount;if(x.type==="stepped"&&t.tweenRunning){return}g._sequentialScroll.call(this,u,F,G)}})},_sequentialScroll:function(r,u,s){var w=r.data(a),q=w.opt,y=w.sequential,x=h("#mCSB_"+w.idx+"_container"),p=y.type==="stepped"?true:false;switch(u){case"on":y.dir=[s==="mCSB_buttonRight"||s==="mCSB_buttonLeft"||s===39||s===37?"x":"y",s==="mCSB_buttonUp"||s==="mCSB_buttonLeft"||s===38||s===37?-1:1];g._stop(r);if(g._isNumeric(s)&&y.type==="stepped"){return}t(p);break;case"off":v();if(p||w.tweenRunning&&y.dir){t(true)}break}function t(z){var F=y.type!=="stepped",J=!z?1e3/60:F?q.scrollInertia/1.5:q.scrollInertia,B=!z?2.5:F?7.5:40,I=[Math.abs(x[0].offsetTop),Math.abs(x[0].offsetLeft)],E=[w.scrollRatio.y>10?10:w.scrollRatio.y,w.scrollRatio.x>10?10:w.scrollRatio.x],C=y.dir[0]==="x"?I[1]+y.dir[1]*(E[1]*B):I[0]+y.dir[1]*(E[0]*B),H=y.dir[0]==="x"?I[1]+y.dir[1]*parseInt(y.scrollAmount):I[0]+y.dir[1]*parseInt(y.scrollAmount),G=y.scrollAmount!=="auto"?H:C,D=!z?"mcsLinear":F?"mcsLinearOut":"mcsEaseInOut",A=!z?false:true;if(z&&J<17){G=y.dir[0]==="x"?I[1]:I[0]}g._scrollTo(r,G.toString(),{dir:y.dir[0],scrollEasing:D,dur:J,onComplete:A});if(z){y.dir=false;return}clearTimeout(y.step);y.step=setTimeout(function(){t()},J)}function v(){clearTimeout(y.step);g._stop(r)}},_arr:function(r){var q=h(this).data(a).opt,p=[];if(typeof r==="function"){r=r()}if(!(r instanceof Array)){p[0]=r.y?r.y:r.x||q.axis==="x"?null:r;p[1]=r.x?r.x:r.y||q.axis==="y"?null:r}else{p=r.length>1?[r[0],r[1]]:q.axis==="x"?[null,r[0]]:[r[0],null]}if(typeof p[0]==="function"){p[0]=p[0]()}if(typeof p[1]==="function"){p[1]=p[1]()}return p},_to:function(v,w){if(v==null||typeof v=="undefined"){return}var C=h(this),B=C.data(a),u=B.opt,D=h("#mCSB_"+B.idx+"_container"),r=D.parent(),F=typeof v;if(!w){w=u.axis==="x"?"x":"y"}var q=w==="x"?D.outerWidth(false):D.outerHeight(false),x=w==="x"?D.offset().left:D.offset().top,E=w==="x"?D[0].offsetLeft:D[0].offsetTop,z=w==="x"?"left":"top";switch(F){case"function":return v();break;case"object":if(v.nodeType){var A=w==="x"?h(v).offset().left:h(v).offset().top}else{if(v.jquery){if(!v.length){return}var A=w==="x"?v.offset().left:v.offset().top}}return A-x;break;case"string":case"number":if(g._isNumeric.call(null,v)){return Math.abs(v)}else{if(v.indexOf("%")!==-1){return Math.abs(q*parseInt(v)/100)}else{if(v.indexOf("-=")!==-1){return Math.abs(E-parseInt(v.split("-=")[1]))}else{if(v.indexOf("+=")!==-1){var s=E+parseInt(v.split("+=")[1]);return s>=0?0:Math.abs(s)}else{if(v.indexOf("px")!==-1&&g._isNumeric.call(null,v.split("px")[0])){return Math.abs(v.split("px")[0])}else{if(v==="top"||v==="left"){return 0}else{if(v==="bottom"){return Math.abs(r.height()-D.outerHeight(false))}else{if(v==="right"){return Math.abs(r.width()-D.outerWidth(false))}else{if(v==="first"||v==="last"){var y=D.find(":"+v),A=w==="x"?h(y).offset().left:h(y).offset().top;return A-x}else{if(h(v).length){var A=w==="x"?h(v).offset().left:h(v).offset().top;return A-x}else{D.css(z,v);b.update.call(null,C[0]);return}}}}}}}}}}break}},_autoUpdate:function(q){var t=h(this),F=t.data(a),z=F.opt,v=h("#mCSB_"+F.idx+"_container");if(q){clearTimeout(v[0].autoUpdate);g._delete.call(null,v[0].autoUpdate);return}var s=v.parent(),p=[h("#mCSB_"+F.idx+"_scrollbar_vertical"),h("#mCSB_"+F.idx+"_scrollbar_horizontal")],D=function(){return[p[0].is(":visible")?p[0].outerHeight(true):0,p[1].is(":visible")?p[1].outerWidth(true):0]},E=y(),x,u=[v.outerHeight(false),v.outerWidth(false),s.height(),s.width(),D()[0],D()[1]],H,B=G(),w;C();function C(){clearTimeout(v[0].autoUpdate);v[0].autoUpdate=setTimeout(function(){if(z.advanced.updateOnSelectorChange){x=y();if(x!==E){r();E=x;return}}if(z.advanced.updateOnContentResize){H=[v.outerHeight(false),v.outerWidth(false),s.height(),s.width(),D()[0],D()[1]];if(H[0]!==u[0]||H[1]!==u[1]||H[2]!==u[2]||H[3]!==u[3]||H[4]!==u[4]||H[5]!==u[5]){r();u=H}}if(z.advanced.updateOnImageLoad){w=G();if(w!==B){v.find("img").each(function(){A(this.src)});B=w}}if(z.advanced.updateOnSelectorChange||z.advanced.updateOnContentResize||z.advanced.updateOnImageLoad){C()}},60)}function G(){var I=0;if(z.advanced.updateOnImageLoad){I=v.find("img").length}return I}function A(L){var I=new Image;function K(M,N){return function(){return N.apply(M,arguments)}}function J(){this.onload=null;r()}I.onload=K(I,J);I.src=L}function y(){if(z.advanced.updateOnSelectorChange===true){z.advanced.updateOnSelectorChange="*"}var I=0,J=v.find(z.advanced.updateOnSelectorChange);if(z.advanced.updateOnSelectorChange&&J.length>0){J.each(function(){I+=h(this).height()+h(this).width()})}return I}function r(){clearTimeout(v[0].autoUpdate);b.update.call(null,t[0])}},_snapAmount:function(r,p,q){return Math.round(r/p)*p-q},_stop:function(p){var r=p.data(a),q=h("#mCSB_"+r.idx+"_container,#mCSB_"+r.idx+"_container_wrapper,#mCSB_"+r.idx+"_dragger_vertical,#mCSB_"+r.idx+"_dragger_horizontal");q.each(function(){g._stopTween.call(this)})},_scrollTo:function(q,s,u){var I=q.data(a),E=I.opt,D={trigger:"internal",dir:"y",scrollEasing:"mcsEaseOut",drag:false,dur:E.scrollInertia,overwrite:"all",callbacks:true,onStart:true,onUpdate:true,onComplete:true},u=h.extend(D,u),G=[u.dur,u.drag?0:u.dur],v=h("#mCSB_"+I.idx),B=h("#mCSB_"+I.idx+"_container"),K=E.callbacks.onTotalScrollOffset?g._arr.call(q,E.callbacks.onTotalScrollOffset):[0,0],p=E.callbacks.onTotalScrollBackOffset?g._arr.call(q,E.callbacks.onTotalScrollBackOffset):[0,0];I.trigger=u.trigger;if(E.snapAmount){s=g._snapAmount(s,E.snapAmount,E.snapOffset)}switch(u.dir){case"x":var x=h("#mCSB_"+I.idx+"_dragger_horizontal"),z="left",C=B[0].offsetLeft,H=[v.width()-B.outerWidth(false),x.parent().width()-x.width()],r=[s,s/I.scrollRatio.x],L=K[1],J=p[1],A=L>0?L/I.scrollRatio.x:0,w=J>0?J/I.scrollRatio.x:0;break;case"y":var x=h("#mCSB_"+I.idx+"_dragger_vertical"),z="top",C=B[0].offsetTop,H=[v.height()-B.outerHeight(false),x.parent().height()-x.height()],r=[s,s/I.scrollRatio.y],L=K[0],J=p[0],A=L>0?L/I.scrollRatio.y:0,w=J>0?J/I.scrollRatio.y:0;break}if(r[1]<0){r=[0,0]}else{if(r[1]>=H[1]){r=[H[0],H[1]]}else{r[0]=-r[0]}}clearTimeout(B[0].onCompleteTimeout);if(!I.tweenRunning&&(C===0&&r[0]>=0||C===H[0]&&r[0]<=H[0])){return}g._tweenTo.call(null,x[0],z,Math.round(r[1]),G[1],u.scrollEasing);g._tweenTo.call(null,B[0],z,Math.round(r[0]),G[0],u.scrollEasing,u.overwrite,{onStart:function(){if(u.callbacks&&u.onStart&&!I.tweenRunning){if(t("onScrollStart")){F();
E.callbacks.onScrollStart.call(q[0])}I.tweenRunning=true;g._onDragClasses(x);I.cbOffsets=y()}},onUpdate:function(){if(u.callbacks&&u.onUpdate){if(t("whileScrolling")){F();E.callbacks.whileScrolling.call(q[0])}}},onComplete:function(){if(u.callbacks&&u.onComplete){if(E.axis==="yx"){clearTimeout(B[0].onCompleteTimeout)}var M=B[0].idleTimer||0;B[0].onCompleteTimeout=setTimeout(function(){if(t("onScroll")){F();E.callbacks.onScroll.call(q[0])}if(t("onTotalScroll")&&r[1]>=H[1]-A&&I.cbOffsets[0]){F();E.callbacks.onTotalScroll.call(q[0])}if(t("onTotalScrollBack")&&r[1]<=w&&I.cbOffsets[1]){F();E.callbacks.onTotalScrollBack.call(q[0])}I.tweenRunning=false;B[0].idleTimer=0;g._onDragClasses(x,"hide")},M)}}});function t(M){return I&&E.callbacks[M]&&typeof E.callbacks[M]==="function"}function y(){return[E.callbacks.alwaysTriggerOffsets||C>=H[0]+L,E.callbacks.alwaysTriggerOffsets||C<=-J]}function F(){var O=[B[0].offsetTop,B[0].offsetLeft],P=[x[0].offsetTop,x[0].offsetLeft],M=[B.outerHeight(false),B.outerWidth(false)],N=[v.height(),v.width()];q[0].mcs={content:B,top:O[0],left:O[1],draggerTop:P[0],draggerLeft:P[1],topPct:Math.round(100*Math.abs(O[0])/(Math.abs(M[0])-N[0])),leftPct:Math.round(100*Math.abs(O[1])/(Math.abs(M[1])-N[1])),direction:u.dir}}},_tweenTo:function(r,u,s,q,A,t,J){var J=J||{},G=J.onStart||function(){},B=J.onUpdate||function(){},H=J.onComplete||function(){},z=g._getTime(),x,v=0,D=r.offsetTop,E=r.style;if(u==="left"){D=r.offsetLeft}var y=s-D;r._mcsstop=0;if(t!=="none"){C()}p();function I(){if(r._mcsstop){return}if(!v){G.call()}v=g._getTime()-z;F();if(v>=r._mcstime){r._mcstime=v>r._mcstime?v+x-(v-r._mcstime):v+x-1;if(r._mcstime<v+1){r._mcstime=v+1}}if(r._mcstime<q){r._mcsid=_request(I)}else{H.call()}}function F(){if(q>0){r._mcscurrVal=w(r._mcstime,D,y,q,A);E[u]=Math.round(r._mcscurrVal)+"px"}else{E[u]=s+"px"}B.call()}function p(){x=1e3/60;r._mcstime=v+x;_request=!l.requestAnimationFrame?function(K){F();return setTimeout(K,.01)}:l.requestAnimationFrame;r._mcsid=_request(I)}function C(){if(r._mcsid==null){return}if(!l.requestAnimationFrame){clearTimeout(r._mcsid)}else{l.cancelAnimationFrame(r._mcsid)}r._mcsid=null}function w(M,L,Q,P,N){switch(N){case"linear":case"mcsLinear":return Q*M/P+L;break;case"mcsLinearOut":M/=P;M--;return Q*Math.sqrt(1-M*M)+L;break;case"easeInOutSmooth":M/=P/2;if(M<1){return Q/2*M*M+L}M--;return-Q/2*(M*(M-2)-1)+L;break;case"easeInOutStrong":M/=P/2;if(M<1){return Q/2*Math.pow(2,10*(M-1))+L}M--;return Q/2*(-Math.pow(2,-10*M)+2)+L;break;case"easeInOut":case"mcsEaseInOut":M/=P/2;if(M<1){return Q/2*M*M*M+L}M-=2;return Q/2*(M*M*M+2)+L;break;case"easeOutSmooth":M/=P;M--;return-Q*(M*M*M*M-1)+L;break;case"easeOutStrong":return Q*(-Math.pow(2,-10*M/P)+1)+L;break;case"easeOut":case"mcsEaseOut":default:var O=(M/=P)*M,K=O*M;return L+Q*(.499999999999997*K*O+-2.5*O*O+5.5*K+-6.5*O+4*M)}}},_getTime:function(){if(l.performance&&l.performance.now){return l.performance.now()}else{if(l.performance&&l.performance.webkitNow){return l.performance.webkitNow()}else{if(Date.now){return Date.now()}else{return(new Date).getTime()}}}},_stopTween:function(){var p=this;if(p._mcsid==null){return}if(!l.requestAnimationFrame){clearTimeout(p._mcsid)}else{l.cancelAnimationFrame(p._mcsid)}p._mcsid=null;p._mcsstop=1},_delete:function(r){try{delete r}catch(q){r=null}},_mouseBtnLeft:function(p){return!(p.which&&p.which!==1)},_pointerTouch:function(q){var p=q.originalEvent.pointerType;return!(p&&p!=="touch"&&p!==2)},_isNumeric:function(p){return!isNaN(parseFloat(p))&&isFinite(p)}};h.fn[e]=function(p){if(b[p]){return b[p].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof p==="object"||!p){return b.init.apply(this,arguments)}else{h.error("Method "+p+" does not exist")}}};h[e]=function(p){if(b[p]){return b[p].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof p==="object"||!p){return b.init.apply(this,arguments)}else{h.error("Method "+p+" does not exist")}}};h[e].defaults=f;l[e]=true;h(l).load(function(){h(k)[e]()})})(jQuery,window,document);